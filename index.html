<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <meta name="title" content="Film Posters of Iran | آرشیو پوسترهای سینمای ایران">
    <meta name="description"
        content="آرشیو پوستر فیلم‌های سینمایی ایرانی قبل و بعد از انقلاب؛ دربردارندهٔ آثار محمدعلی باطنی، محمدعلی حدت، محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی و دیگر طراحان گرافیک.">
    <meta name="keywords"
        content="پوستر فیلم, فیلم ایرانی, پوستر سینمایی, محمدعلی باطنی, محمدعلی حدت, محسن دولو, مرتضی ممیز, ابراهیم حقیقی, قباد شیوا, فرشید مثقالی, جشنواره فیلم فجر, دانلود پوستر فیلم, عباس کیارستمی film posters of Iran, Iranian films">
    <meta property="twitter:title" content="Film Posters of Iran | آرشیو پوسترهای سینمای ایران">
    <meta property="twitter:description"
        content="آرشیو پوستر فیلم‌های سینمایی ایرانی قبل و بعد از انقلاب؛ دربردارندهٔ آثار محمدعلی باطنی، محمدعلی حدت، محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی و دیگر طراحان گرافیک">
    <meta property="og:title" content="Film Posters of Iran | آرشیو پوسترهای سینمای ایران" />
    <meta property="og:site_name" content="آرشیو پوسترهای سینمای ایران" />
    <meta property="og:description"
        content="آرشیو پوستر فیلم‌های سینمایی ایرانی قبل و بعد از انقلاب؛ دربردارندهٔ آثار محمدعلی باطنی، محمدعلی حدت، محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی و دیگر طراحان گرافیک" />
    <title>آرشیو پوسترهای سینمای ایران</title>
    <link rel="icon" href="favicon.svg">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define light and dark mode variables */
        :root {
            --body-bg-light: #f8f8f8;
            --body-text-light: #333;
            --card-bg-light: #ffffff;
            --border-light: #e0e0e0;
            --input-bg-light: #ffffff;
            --input-border-light: #d1d5db;
            --text-secondary-light: #6b7280;
            --primary-color-light: #ef4444; /* Red-500 */
        }

        :root[data-theme="dark"] {
            --body-bg-dark: #1f2937;
            --body-text-dark: #e5e7eb;
            --card-bg-dark: #374151;
            --border-dark: #4b5563;
            --input-bg-dark: #111827;
            --input-border-dark: #4b5563;
            --text-secondary-dark: #9ca3af;
            --primary-color-dark: #ef4444; /* Red-500 */
        }

        /* Apply theme variables using a class or data attribute on body/html */
        body {
            background-color: var(--body-bg-light);
            color: var(--body-text-light);
        }
        body[data-theme="dark"] {
            background-color: var(--body-bg-dark);
            color: var(--body-text-dark);
        }

        /* General styles to override system-ui and apply Inter font */
        * {
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }

        /* Material Symbols Rounded font-face */
        @font-face {
            font-family: 'Material Symbols Rounded';	/* https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded&icon_names=arrow_back_ios,arrow_forward_ios,close,download,info,keyboard_arrow_up,menu,north,person_edit,refresh,swap_vert */
            src: url(data:application/octet-stream;base64,d09GMgABAAAAAApcAA0AAAAAFBgAAAoFAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHINcBmA/U1RBVHAAgVwRCAqYAJIvC0gAATYCJANIBCAFhH4HIBseECNSs3ogU0fqwp8//34Q1FrZMztLdMQfRoXECvXXu9hItIkCYM+ocA91phQo6EIwlmACwO3J8ARgtSy3/AiwOs6YZaxP4Jz/KphkMPEEk8JSvJimQ8wbiojOOhFNJt7b8kW9fLPCTPt/a63OoRKSWbqQr6adv3MyO2cCDGbeLJF5nW6qiZIsEmok4td+mg91SW+aMLgU7bnSmHz83GkQgEMbeiGHjxw/nWD9ku0bCVCMVD8K5bauX7MK6ywu51OYgOQdTuZqYCG4gslpmtnHZqYzmAySAsZ/C+zGp05MK3xyVDGxaRAv0UrFy1R9xEvMmKZkQUyF9D13cbVlKxQp0IqSIjLcAgOdoiXhUVsI4AVqGapDwHxNBBTxKRNVnVemTJHiW1EDcGBbtkCKIkI0zJAlT4FSda06Nt9xFEsZTjcCBXSHZ8hJFnnjBXKV6CJdf5aioSSFgYNuAY0g168WqRAjaYOBRtA4AXk+IVliGQZ0rJUGGsvKQ0i6RfQgwIJGmBClXRAt6Kxi6Y7QhIQ3tHdU4FCjJk0axQUav36rRnIEVDvmvfEhaBe0C/ENOpMAZkmW2Zfvgxw5Zvz4ImcfNXXIcCEQmzZv2yskcteq1duFhkYP2lDA4tpQClO0gDzjt6JECo8CsLQItx7gSBVjwsS0qpimhCrpDbxPNxooAhosYiVr2Mwu9jy7/Hz88y0vrrzMvb77+tHrp6+fvzv0rvnd028t35/9+p0kHRjfIpawmnVs5Sp49qDJp+RycjI5kRxPjiVH68Nr52qHq8MrX0sDSv1LXUut84fy2/K9wt1BOzcepu5aYWQkCeGZtTaRjUSDPLRTvuqKs8V19OEha5mEgWD20MC5t1S3o2+9NiktmSPwMp7XM5dL1yIUyDWickkZulfbVJFtd3AcD6U8Sxm5AI8b2q6telg5J+cp1wyNpfPmrtFnz/bninmehyR5CGM6SFg/QtJAmDx0kysNRDAVAZh6A0D2BCBJ2VKQvZiqhClI8oRRiqU5jrEwrfUc0yGQBxCS+glhgxkbTBZ+U5C9N+v6nDUNDkUJS6hpdlQzV2JtI6ZN7qS6GWeN5MhLrG1z18nOhJoGJNU74qtnXbXUncZVs2N5sU528jWSSaM4Noj1XPX0o+w6kGvGLQWd1J/EBjE2UGpQPepGaMkQVusSapvcdX1OvqHgFifZXHV1UozmXLRII800GCObY6uYX4NSbKT0NlNaJmJrqRmjlfpJZqJPaliCUEtjPV+6qmvqQWV4Wy4a061LR727h9tc7yxhyrvqeoQAGdhgzNA1Euv6QO5xPh6yBK66u+e3jMNPMAfi1auceBU/xrFvz5eRpAjyGqarhC0jaUV8C9fBaZBCUpNF0cyD3lgs4RbaOSSSWOPbbjfgeT8x7458nrSq6nPWKTLX6z0FCrSKF7W9mFYEvRWZkHmrvs6mAT1ozFrQEW00FzbqDdiKDDojUtXJg2xkThQTIOn45SDiOtyM4tU/R64Fk9Ab5IxtWgGc1adNCskZTQxTcWfFlJSbwBRUN4fe/I7OJgaNtjuiClMbyigIFUP8aKFLlTFVVfXibMtFzwbyieAez22PqmaT4UnUgsYKTodTFCUmFRJ4EJMgmY+EiDNwLmr0SuEk8iw5HW7UJkJCAAQlQbyGx1a0v35t3Vc2ETeR8OvgcCJu70/8RFzoWEw08rmtidZ2ImOr5elFnPwiy/GgP0/S0p78CQp68ict7c+ToOyYgX6fFxY+zwZ8evqTZ/e1PS58XXFv+41L3X6Mk/rS/8ynH4qqWr++CncT2xz798B7v93VDbil7irFRp2zs95Er3fTy2nhRRubFwW5XD+cNSP6MTINctfTcqkZB4DOZt8+zoHjHDitViAFrXY0K3SpRA1Rum8vB0E+kE6X/YWp6RfZOh1H8QIl7N1bStSgVkvUEA8YhqNuCpSwaZN+Jo1GsBFuzgsM8yAa9KecZb8EPwm6NBHIC3BZhVbJCRB4G0GjqfTgIqWn0h42SwMwC+C2EqWncGiOtMOHYQ+9PS+E7tTrr7dx2K+/fh4JurlfpA8W4Zro4PbRT0Orop0TTIOjY+hM+yB2WcH4EQtyPm0JUaNZRNt+wL3xxnSuhWXedGz3hIVF5/Qbb3Dv29JEjeccYvHenEt3zwKqp3tDDRWP6XEpurg4elsclUrpqWQgmVrxX+Ls+WrufENnU1dT4EVPpYeXEix/r/BQoio4IvZj0WB8aozqUF4Jn3g2PTMmKDgzIv0scyA9JUQekOKXfgAPrLMOevTmJU0UFCaN9+Ye9MhSjNi10lm5VrEFHyQEFzqUWbpG9jtWxIXWxmq+mpx0qLEsJ5MUYQVGsdn53fSUHVh+bM/86VOWp+ZP7XFLdB+4NDBtOXOpb8AdLL9c+er3KkZ1+90ksLxM+cXffUl9MrB8gYuvSxFfpPBVQMF0L+5mGKZ7cTej/F86knR4/Rd3r7NCY4KXYTfUN8qa3lGiku+Yty2QMvO2HXzuowip+o+HGX8+LJX6PALLl6yJkoZLcvhSWbh0tQGz1qfvHL9OXL9z/PSpOyevElfvnDyZPC4MaAiNMDg+eXNgM7FZ6AfLG9HV9uk+fqkKhTw1w6fanuYtsvnYYTozc3RNNA+WJ4o3l9c2bCwr0y4u04ZnRURHZ4eGaUvLfnYstf3PD79ZX32Y3WZcYBxxWsEdP+svd66lJ8mBBZVf99ip3JXKiLTLJd/ePtWUY1xoHLU9gDum8Q5aluzWuKrVPu6d1W/l1Rb9WICrZRPKCuVYGWatE2dcGlOiutL7CvrGLrNtLVfVI315femRXY0p0y64LL18oUbxKEwljVCFPCq/fgE/St+8ULxRvEO6Y5u4crd4t3R6Rlz05oWiXWaC9P2dZrgMjht1lq2SylxkvRwHeBcoq5QAAAAwPDAYZiECIP7I/v1mzzOlNqH3TMWSVwDg1xun3wGO67z2xHDXcELygeRVAMbBoxhQkqC2keQVw13DXckHFq1XpxBJXsE7SMNhUCJrkQjf4hIOoxvfAhjxLCLHhKgC8WpUShaXnTsIPigHsAQmkFUTAEeR3qHS9lcJ1jgfmEnS4C2pTNR8FZDkK4pEhBjWIjpCggzMRkgRicMRRliGyXBjhIKRRAGjLhoCkswRBAFJS0BCgNYynMail0k1GSILWIbpIIDuA6Dhh2a0IwVqtIJFOVTIRTXqUYs6tCNVw+tRqQwkkTlbL6qRgFaUo0rQeEFVlJeMcrQTb0U9r24mesCiAup5wzZkQI0ONLFnq4I3MlCNWnSAloPl2NA2+dNqNIEEDRmC4At/j/2Rsj9SKiJbefnsFEhAKlKRAEUz28l0a9NoDHgzerhkcKGj8b6gaTYSCVBDjVqoREUSa7EWMa9BnETUHDypbIhfXo22ilnnnMlepFqt2v9gAgAA) format('woff');
        }

        .material-symbols-rounded {
            font-family: 'Material Symbols Rounded';
            font-size: 24px;
            display: inline-block;
            white-space: nowrap;
            line-height: 1;
            /* Using currentColor to adapt to parent's text color */
            color: currentColor; 
        }

        /* Utility classes for dark mode and transitions */
        .bg-card {
            background-color: var(--card-bg-light);
        }
        body[data-theme="dark"] .bg-card {
            background-color: var(--card-bg-dark);
        }

        .border-base {
            border-color: var(--border-light);
        }
        body[data-theme="dark"] .border-base {
            border-color: var(--border-dark);
        }

        .input-bg {
            background-color: var(--input-bg-light);
        }
        body[data-theme="dark"] .input-bg {
            background-color: var(--input-bg-dark);
        }

        .input-border {
            border-color: var(--input-border-light);
        }
        body[data-theme="dark"] .input-border {
            border-color: var(--input-border-dark);
        }

        .text-secondary {
            color: var(--text-secondary-light);
        }
        body[data-theme="dark"] .text-secondary {
            color: var(--text-secondary-dark);
        }

        .primary-color {
            background-color: var(--primary-color-light);
        }
        body[data-theme="dark"] .primary-color {
            background-color: var(--primary-color-dark);
        }

        /* Specific styles for better visuals */
        .item-card {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .item-image {
            transition: filter 0.3s ease-in-out;
        }

        .toggle-switch span.active {
            font-weight: 600;
        }

        .triple-switch span.active {
            font-weight: 600;
        }

        .filter-item {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .filter-item:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        
        /* Sidebar specific adjustments */
        .sidebar-section-header {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s, border-radius 0.4s cubic-bezier(1, 0, 0, 1);
        }

        .sidebar-section.expanded .sidebar-section-header {
            box-shadow: none; /* Remove shadow when expanded to avoid double shadow with body */
        }
        .sidebar-section-body {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        body[data-theme="dark"] .sidebar-section-body {
            background-color: #1a202c; /* Darker background for sidebar body in dark mode */
        }

        .sidebar-resize-handle {
            background-color: transparent; /* Make handle less intrusive */
        }
        .sidebar-resize-handle:hover {
            background-color: rgba(128, 128, 128, 0.2); /* Slightly visible on hover */
        }

        /* Lightbox improvements */
        .lightbox-button {
            transition: background 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .lightbox-button:hover {
            background: rgba(255, 255, 255, 0.2); /* Lighter hover for dark background */
            transform: scale(1.05);
        }

        .lightbox-info {
            background-color: rgba(0, 0, 0, 0.7); /* Keep it dark and readable */
            color: white;
        }
        
        /* Show More button styling */
        #show-more-button {
            background-color: var(--primary-color-light);
            color: white;
            padding: 12px 24px;
            border-radius: 9999px; /* Fully rounded */
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        #show-more-button:hover {
            background-color: #dc2626; /* Red-600 */
            transform: translateY(-2px);
        }
        body[data-theme="dark"] #show-more-button {
            background-color: var(--primary-color-dark);
        }

        /* Tooltip style */
        .tooltip .tooltiptext {
            background-color: #333;
            color: #fff;
        }
        .tooltip .tooltiptext::after {
            border-color: transparent transparent #333 transparent;
        }

        /* Scrollbar styling */
        .sidebar-section-body::-webkit-scrollbar,
        body::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .sidebar-section-body::-webkit-scrollbar-track,
        body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .sidebar-section-body::-webkit-scrollbar-thumb,
        body::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .sidebar-section-body::-webkit-scrollbar-thumb:hover,
        body::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            #main-content {
                padding: 0 15px; /* Adjust padding for small screens */
            }
            .search-bar {
                padding: 10px 15px; /* Consistent padding */
                border-radius: 0; /* Full width on mobile, remove top radius */
            }
            .options {
                flex-direction: column; /* Stack options vertically */
                align-items: stretch;
                padding: 0 10px 10px;
            }
            .toggle-switch, .triple-switch {
                width: 100%; /* Full width for switches */
                justify-content: center;
            }
            .similar-chars-toggle {
                justify-content: space-between;
                width: 100%;
            }
            .sort-order-container {
                width: 100%;
                justify-content: center;
            }
            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Smaller cards on mobile */
                gap: 10px;
            }
            .item-card {
                padding: 10px;
            }
            .sidebar {
                width: 100% !important; /* Full width for sidebar on mobile */
                right: -100%; /* Ensure it slides in from right */
            }
        }
    </style>
</head>
<body :data-theme="darkMode ? 'dark' : 'light'">
    <div id="app" class="flex flex-1 w-full p-5 sm:p-0">
        <!-- Sidebar Overlay (Mobile Only) -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
            :class="{ 'hidden': !sidebarVisible }" @click="hideSidebar"></div>

        <!-- Sidebar -->
        <div id="sidebar"
            class="fixed top-0 right-0 h-full overflow-y-auto bg-card z-50 transition-transform duration-300 ease-in-out shadow-lg lg:relative lg:translate-x-0 lg:shadow-none lg:w-96"
            :class="{ 'translate-x-full': !sidebarVisible, 'translate-x-0': sidebarVisible }"
            :style="{ width: sidebarWidth + 'px' }">
            <div class="sidebar-resize-handle hidden lg:block"></div>
            <div class="sidebar-content p-4 lg:p-0">
                <!-- Close Button (Mobile Only) -->
                <button @click="hideSidebar" id="hideSidebarButton"
                    class="lg:hidden absolute top-4 right-4 p-2 text-gray-600 dark:text-gray-300 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                    <span class="material-symbols-rounded">close</span>
                </button>
                <a href="https://t.me/arastehnasab"
                    class="lg:hidden block text-gray-500 dark:text-gray-400 font-normal text-sm p-4 text-right">
                    پیشنهادی دارید؟
                </a>
                
                <!-- Sidebar Sections -->
                <div class="sidebar-section mb-4 rounded-xl overflow-hidden"
                    :class="getSectionClass('years')">
                    <div class="sidebar-section-header bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 p-3 flex justify-between items-center cursor-pointer rounded-xl"
                        @click="toggleCollapse('years')">
                        <span class="font-bold text-lg">{{ filteredYearLabel }}</span>
                        <button class="collapse-button text-gray-600 dark:text-gray-300"
                            :class="collapseIconClass(isCollapsed.years)">
                            <span class="material-symbols-rounded text-2xl">keyboard_arrow_up</span>
                        </button>
                    </div>
                    <div class="sidebar-section-body bg-card p-4 border border-base max-h-96 overflow-auto">
                        <div class="year-grid flex flex-wrap gap-2">
                            <div v-if="filteredYearsInModal.length === 0" class="no-results text-center text-gray-500 w-full">
                                نتیجه‌ای وجود ندارد
                            </div>
                            <div v-else v-for="[year, count] in filteredYearsInModal" :key="year"
                                @click="selectedYear === year ? removeYearFilter() : selectYearFromModal(year)"
                                class="year-item bg-gray-100 dark:bg-gray-800 text-sm py-2 px-4 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2"
                                :class="{ 'bg-primary-color !text-white': selectedYear === year }">
                                {{ year }} <span class="count text-secondary">({{ count }})</span>
                                <span v-if="selectedYear === year" class="remove-filter text-white hover:text-gray-200"
                                    @click.stop="removeYearFilter">
                                    <span class="material-symbols-rounded text-sm">close</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section mb-4 rounded-xl overflow-hidden"
                    :class="getSectionClass('designers')">
                    <div class="sidebar-section-header bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 p-3 flex justify-between items-center cursor-pointer rounded-xl"
                        @click="toggleCollapse('designers')">
                        <span class="font-bold text-lg">{{ filteredDesignerLabel }}</span>
                        <button class="collapse-button text-gray-600 dark:text-gray-300"
                            :class="collapseIconClass(isCollapsed.designers)">
                            <span class="material-symbols-rounded text-2xl">keyboard_arrow_up</span>
                        </button>
                    </div>
                    <div class="sidebar-section-body bg-card p-4 border border-base max-h-96 overflow-auto">
                        <div class="search-container mb-4">
                            <input type="text" v-model="designerSearchQuery" placeholder="جستجوی طراح…"
                                class="w-full p-2 rounded-lg bg-input-bg border input-border focus:ring-2 focus:ring-primary-color focus:border-transparent transition" />
                            <span v-if="designerSearchQuery" @click="clearDesignerSearchQuery"
                                class="absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition">
                                <span class="material-symbols-rounded">close</span>
                            </span>
                        </div>
                        <div class="designer-grid flex flex-wrap gap-2">
                            <div v-if="filteredDesignersInModal.length === 0"
                                class="no-results text-center text-gray-500 w-full">
                                نتیجه‌ای وجود ندارد
                            </div>
                            <div v-else v-for="[designer, count] in filteredDesignersInModal" :key="designer"
                                @click="selectedDesigner === designer ? removeDesignerFilter() : selectDesignerFromModal(designer)"
                                class="designer-item bg-gray-100 dark:bg-gray-800 text-sm py-2 px-4 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2"
                                :class="{ 'bg-primary-color !text-white': selectedDesigner === designer }">
                                {{ designer }} <span class="count text-secondary">({{ count }})</span>
                                <span v-if="selectedDesigner === designer"
                                    class="remove-filter text-white hover:text-gray-200"
                                    @click.stop="removeDesignerFilter">
                                    <span class="material-symbols-rounded text-sm">close</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section mb-4 rounded-xl overflow-hidden"
                    :class="getSectionClass('directors')">
                    <div class="sidebar-section-header bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 p-3 flex justify-between items-center cursor-pointer rounded-xl"
                        @click="toggleCollapse('directors')">
                        <span class="font-bold text-lg">{{ filteredDirectorLabel }}</span>
                        <button class="collapse-button text-gray-600 dark:text-gray-300"
                            :class="collapseIconClass(isCollapsed.directors)">
                            <span class="material-symbols-rounded text-2xl">keyboard_arrow_up</span>
                        </button>
                    </div>
                    <div class="sidebar-section-body bg-card p-4 border border-base max-h-96 overflow-auto">
                        <div class="search-container mb-4">
                            <input type="text" v-model="directorSearchQuery" placeholder="جستجوی کارگردان…"
                                class="w-full p-2 rounded-lg bg-input-bg border input-border focus:ring-2 focus:ring-primary-color focus:border-transparent transition" />
                            <span v-if="directorSearchQuery" @click="clearDirectorSearchQuery"
                                class="absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition">
                                <span class="material-symbols-rounded">close</span>
                            </span>
                        </div>
                        <div class="director-grid flex flex-wrap gap-2">
                            <div v-if="filteredDirectorsInModal.length === 0"
                                class="no-results text-center text-gray-500 w-full">
                                نتیجه‌ای وجود ندارد
                            </div>
                            <div v-else v-for="[director, count] in filteredDirectorsInModal" :key="director"
                                @click="selectedDirector === director ? removeDirectorFilter() : selectDirectorFromModal(director)"
                                class="director-item bg-gray-100 dark:bg-gray-800 text-sm py-2 px-4 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2"
                                :class="{ 'bg-primary-color !text-white': selectedDirector === director }">
                                {{ director }} <span class="count text-secondary">({{ count }})</span>
                                <span v-if="selectedDirector === director"
                                    class="remove-filter text-white hover:text-gray-200"
                                    @click.stop="removeDirectorFilter">
                                    <span class="material-symbols-rounded text-sm">close</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section mb-4 rounded-xl overflow-hidden"
                    :class="getSectionClass('letters')">
                    <div class="sidebar-section-header bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 p-3 flex justify-between items-center cursor-pointer rounded-xl"
                        @click="toggleCollapse('letters')">
                        <span class="font-bold text-lg">{{ filteredLetterLabel }}</span>
                        <button class="collapse-button text-gray-600 dark:text-gray-300"
                            :class="collapseIconClass(isCollapsed.letters)">
                            <span class="material-symbols-rounded text-2xl">keyboard_arrow_up</span>
                        </button>
                    </div>
                    <div class="sidebar-section-body bg-card p-4 border border-base max-h-96 overflow-auto">
                        <div class="letter-grid flex flex-wrap gap-2">
                            <div v-if="filteredLettersInModal.length === 0"
                                class="no-results text-center text-gray-500 w-full">
                                نتیجه‌ای وجود ندارد
                            </div>
                            <div v-else v-for="[letter, count] in filteredLettersInModal" :key="letter"
                                @click="selectedLetter === letter ? removeLetterFilter() : selectLetterFromModal(letter)"
                                class="letter-item bg-gray-100 dark:bg-gray-800 text-sm py-2 px-4 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2"
                                :class="{ 'bg-primary-color !text-white': selectedLetter === letter }">
                                {{ letter }} <span class="count text-secondary">({{ count }})</span>
                                <span v-if="selectedLetter === letter"
                                    class="remove-filter text-white hover:text-gray-200"
                                    @click.stop="removeLetterFilter">
                                    <span class="material-symbols-rounded text-sm">close</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="flex-1 flex flex-col items-center w-full max-w-full overflow-x-hidden p-0 sm:p-5">
            <!-- Scroll to Top Button -->
            <button @click="bringToTop" id="toTop"
                class="fixed bottom-5 left-5 z-30 w-14 h-14 bg-gray-600 text-white rounded-full flex items-center justify-center text-xl shadow-lg hover:opacity-80 transition-all duration-300"
                :class="{ 'opacity-100 visible': visibleBringToTop, 'opacity-0 invisible': !visibleBringToTop }">
                <span class="material-symbols-rounded">north</span>
            </button>

            <!-- Lightbox -->
            <div v-if="lightboxItem" class="fixed inset-0 bg-black bg-opacity-90 flex justify-center items-center z-50 p-4"
                @click="closeLightbox">
                <template v-if="lightboxImage">
                    <img :src="lightboxImage" :key="lightboxImage" alt="Lightbox Image"
                        class="max-w-[90vw] max-h-[90vh] rounded-xl object-contain shadow-2xl" />
                </template>
                <template v-else>
                    <div class="no-logo-placeholder bg-gray-700 text-gray-400 rounded-xl flex items-center justify-center p-8 text-lg">
                        (بدون لوگو)
                    </div>
                </template>
                <div class="loading-spinner absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" v-if="isLoading">
                    <svg width="53" height="53" viewBox="0 0 53 53" xmlns="http://www.w3.org/2000/svg">
                        <svg:style type="text/css">
                            @keyframes scale_SQHYY {
                                0%, 100% { transform: scale(1); }
                                50% { transform: scale(0.7); }
                            }
                            @keyframes fade_SQHYY {
                                0%, 100% { opacity: 1; }
                                50% { opacity: 0.5; }
                            }
                        </svg:style>
                        <circle cx="6.5" cy="6.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.57s; transform-origin: 6.5px 6.5px;"></circle>
                        <circle cx="6.5" cy="26.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.32s; transform-origin: 6.5px 26.5px;"></circle>
                        <circle cx="6.5" cy="46.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.82s; transform-origin: 6.5px 46.5px;"></circle>
                        <circle cx="26.5" cy="6.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.04s; transform-origin: 26.5px 6.5px;"></circle>
                        <circle cx="26.5" cy="26.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.12s; transform-origin: 26.5px 26.5px;"></circle>
                        <circle cx="26.5" cy="46.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -1.2s; transform-origin: 26.5px 46.5px;"></circle>
                        <circle cx="46.5" cy="6.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.46s; transform-origin: 46.5px 6.5px;"></circle>
                        <circle cx="46.5" cy="26.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.9s; transform-origin: 46.5px 26.5px;"></circle>
                        <circle cx="46.5" cy="46.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.73s; transform-origin: 46.5px 46.5px;"></circle>
                    </svg>
                </div>
                <!-- Lightbox Controls -->
                <button class="lightbox-button absolute top-5 left-5 text-white text-4xl p-2 rounded-full"
                    @click.stop="closeLightbox">
                    <span class="material-symbols-rounded">close</span>
                </button>
                <a :href="downloadLink(lightboxItem)" aria-label="دریافت پوستر" target="_blank">
                    <button class="lightbox-button absolute top-5 right-5 text-white text-4xl p-2 rounded-full">
                        <span class="material-symbols-rounded">download</span>
                    </button>
                </a>
                <button class="lightbox-button absolute left-5 top-1/2 -translate-y-1/2 text-white text-4xl p-2 rounded-full hidden md:block"
                    @click.stop="nextImage">
                    <span class="material-symbols-rounded">arrow_back_ios</span>
                </button>
                <button class="lightbox-button absolute right-5 top-1/2 -translate-y-1/2 text-white text-4xl p-2 rounded-full hidden md:block"
                    @click.stop="prevImage">
                    <span class="material-symbols-rounded">arrow_forward_ios</span>
                </button>
                <!-- Lightbox Info (Desktop Only) -->
                <div class="lightbox-info absolute bottom-5 right-5 bg-black bg-opacity-70 text-white p-4 rounded-xl max-w-xs text-right hidden md:block"
                    v-if="lightboxItem">
                    <h2 class="text-xl font-bold mb-1">{{ lightboxItem.filmLabel }}</h2>
                    <p class="text-sm">سال تولید: {{ toPersianYear(lightboxItem.date) }}</p>
                    <p class="text-sm" v-if="lightboxItem.directorLabel">کارگردان: {{ lightboxItem.directorLabel }}</p>
                    <p class="text-sm" v-if="lightboxItem.designers && lightboxItem.designers.length > 0">
                        طراح پوستر:
                        <span v-for="(designer, index) in lightboxItem.designers" :key="index">
                            {{ designer.label }}<span v-if="index < lightboxItem.designers.length - 1">, </span>
                        </span>
                    </p>
                </div>
            </div>

            <!-- Search Bar and Options -->
            <div id="searchBar"
                class="search-bar sticky top-0 w-full max-w-4xl bg-card rounded-2xl shadow-md p-4 mb-4 z-20 transition-all duration-300 ease-in-out">
                <div class="flex items-center gap-3">
                    <button @click="toggleSidebar" id="toggleSidebarButton"
                        class="lg:hidden p-2 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <span class="material-symbols-rounded text-3xl">menu</span>
                    </button>
                    <div class="relative flex-grow">
                        <input type="text" v-model="searchTerm" :placeholder="searchPlaceholder"
                            @focus="onSearchFocus" @blur="onSearchBlur"
                            class="w-full p-3 pr-10 rounded-xl bg-input-bg border input-border focus:ring-2 focus:ring-primary-color focus:border-transparent transition" />
                        <span v-if="searchTerm" @click="clearSearchTerm"
                            class="clearSearch absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition">
                            <span class="material-symbols-rounded text-2xl">close</span>
                        </span>
                    </div>
                    <button @click="resetFilters" id="resetSearch"
                        class="p-2 bg-gray-500 text-white rounded-full text-2xl hover:bg-red-500 transition-colors shadow-md">
                        <span class="material-symbols-rounded">refresh</span>
                    </button>
                    <button @click="toggleOptions" id="collapseButton"
                        class="lg:hidden p-2 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <span class="material-symbols-rounded text-3xl" :class="collapseIconClass(isOptionsCollapsed)">keyboard_arrow_up</span>
                    </button>
                </div>

                <div class="options flex flex-wrap justify-around gap-4 mt-4 transition-all duration-300 ease-in-out"
                    :class="{ 'max-h-0 opacity-0 overflow-hidden !mt-0': isOptionsCollapsed, 'max-h-96 opacity-100': !isOptionsCollapsed }">
                    <!-- Poster/Logo Toggle -->
                    <div class="toggle-switch flex items-center bg-gray-200 dark:bg-gray-700 rounded-full p-1 cursor-pointer w-32 relative transition-colors"
                        @click="togglePosterMode" :data-mode="posterMode ? 'poster' : 'logo'">
                        <span class="flex-1 text-center py-2 px-3 rounded-full z-10 transition-colors"
                            :class="{ 'text-white font-semibold': posterMode }">پوستر</span>
                        <span class="flex-1 text-center py-2 px-3 rounded-full z-10 transition-colors"
                            :class="{ 'text-white font-semibold': !posterMode }">لوگو</span>
                        <div class="absolute top-1 left-1 w-[calc(50%-4px)] h-[calc(100%-8px)] bg-primary-color rounded-full transition-transform duration-400 ease-in-out"
                            :class="{ 'translate-x-full': !posterMode }"></div>
                    </div>

                    <!-- Similar Chars Toggle -->
                    <div class="similar-chars-toggle flex items-center gap-2 text-gray-700 dark:text-gray-300">
                        <label for="similarCharsSwitch" class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="similarCharsSwitch" v-model="combineSimilarChars"
                                class="w-4 h-4 rounded text-primary-color focus:ring-primary-color border-gray-300 dark:border-gray-600 dark:bg-gray-800">
                            حروف مشابه
                        </label>
                        <label class="tooltip relative cursor-pointer">
                            <span class="material-symbols-rounded text-lg text-gray-500">info</span>
                            <span class="tooltiptext absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 text-xs bg-gray-800 text-white rounded-md whitespace-normal shadow-lg w-40 text-center">
                                حروفی که شکل یکسانی دارند، یکی در نظر گرفته شود: مانند س، ش
                            </span>
                        </label>
                    </div>

                    <!-- Exact Word Match Toggle -->
                    <div class="similar-chars-toggle flex items-center gap-2 text-gray-700 dark:text-gray-300">
                        <label for="exactWordSwitch" class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="exactWordSwitch" v-model="exactWordMatch"
                                class="w-4 h-4 rounded text-primary-color focus:ring-primary-color border-gray-300 dark:border-gray-600 dark:bg-gray-800">
                            جستجوی دقیق
                        </label>
                        <label class="tooltip relative cursor-pointer">
                            <span class="material-symbols-rounded text-lg text-gray-500">info</span>
                            <span class="tooltiptext absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 text-xs bg-gray-800 text-white rounded-md whitespace-normal shadow-lg w-40 text-center">
                                فقط نتایجی که دقیقاً با کلمه وارد شده مطابقت دارند
                            </span>
                        </label>
                    </div>

                    <!-- Censor/Pixelated Toggle -->
                    <div class="similar-chars-toggle flex items-center gap-2 text-gray-700 dark:text-gray-300">
                        <label for="pixelatedSwitch" class="flex items-center gap-2 cursor-pointer"
                            :class="{ 'opacity-50 cursor-not-allowed': !posterMode }">
                            <input type="checkbox" id="pixelatedSwitch" v-model="pixelatedEffect"
                                :disabled="posterMode ? null : true"
                                class="w-4 h-4 rounded text-primary-color focus:ring-primary-color border-gray-300 dark:border-gray-600 dark:bg-gray-800">
                            سانسور
                        </label>
                        <label class="tooltip relative cursor-pointer">
                            <span class="material-symbols-rounded text-lg text-gray-500">info</span>
                            <span class="tooltiptext absolute top-full left-1/2 -translate-x-1/2 mt-2 p-2 text-xs bg-gray-800 text-white rounded-md whitespace-normal shadow-lg w-40 text-center"
                                v-if="posterMode">مخفی کردن تصاویری که ممکن است نامناسب باشند</span>
                        </label>
                    </div>

                    <!-- Sort Order Triple Switch -->
                    <div class="sort-order-container flex items-center gap-3">
                        <label class="text-gray-700 dark:text-gray-300">
                            <span class="material-symbols-rounded text-lg">swap_vert</span>
                        </label>
                        <div class="triple-switch flex items-center bg-gray-200 dark:bg-gray-700 rounded-full p-1 cursor-pointer relative transition-colors"
                            :data-sort="sortOrder">
                            <span class="text-center py-2 px-4 rounded-full z-10 transition-colors"
                                :class="{ 'text-white font-semibold': sortOrder === 'alphabetical' }"
                                @click="sortOrder = 'alphabetical'">الفبایی</span>
                            <span class="text-center py-2 px-4 rounded-full z-10 transition-colors"
                                :class="{ 'text-white font-semibold': sortOrder === 'year' }"
                                @click="sortOrder = 'year'">سال</span>
                            <span class="text-center py-2 px-4 rounded-full z-10 transition-colors"
                                :class="{ 'text-white font-semibold': sortOrder === 'random' }"
                                @click="sortOrder = 'random'">تصادفی</span>
                            <div class="absolute top-1 bg-primary-color rounded-full transition-transform duration-400 ease-in-out"
                                :class="{
                                    'left-1 w-[calc(33.33%-4px)]': sortOrder === 'random',
                                    'translate-x-[calc(100%-8px)] w-[calc(33.33%-8px)]': sortOrder === 'year',
                                    'translate-x-[calc(200%-12px)] w-[calc(33.33%-12px)]': sortOrder === 'alphabetical'
                                }"
                                :style="{ height: 'calc(100% - 8px)' }"></div>
                        </div>
                    </div>
                </div>

                <!-- Item Count Display -->
                <div v-if="filteredItems.length > 0"
                    class="mt-4 text-center text-gray-600 dark:text-gray-400 text-sm">
                    <span v-if="hasActiveFilters">{{ filteredItemsLength }} از {{ itemsLength }} پوستر ({{ uniqueResultsFilmCount }} از {{ uniqueFilmCount }} فیلم)</span>
                    <span v-else>{{ itemsLength }} پوستر ({{ uniqueFilmCount }} فیلم)</span>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div id="filters" v-if="activeFilters.length > 0"
                class="filters-container w-full max-w-4xl flex flex-wrap gap-2 p-3 mb-4 bg-card rounded-2xl shadow-md">
                <div v-for="(filter, index) in activeFilters" :key="index"
                    class="filter-item flex items-center gap-1 py-1 px-3 bg-gray-100 dark:bg-gray-700 rounded-full text-sm text-gray-700 dark:text-gray-200 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                    <span class="align-middle">{{ filter.label }}: {{ filter.value }}</span>
                    <button class="remove-filter text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition"
                        @click.stop="removeFilter(filter.type, filter.value)">
                        <span class="material-symbols-rounded text-base">close</span>
                    </button>
                </div>
            </div>

            <!-- Results Grid -->
            <div v-if="filteredItems.length > 0"
                class="results-grid grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 w-full max-w-4xl pb-10">
                <div class="item-card bg-card rounded-xl overflow-hidden shadow-lg flex flex-col justify-between items-center transition-all duration-200"
                    v-for="(item, index) in filteredItems.slice(0, displayedItemsCount)" :key="index">
                    <div class="flex flex-col justify-center items-center w-full h-full p-2">
                        <div class="image-container relative w-full flex justify-center items-center">
                            <a @click="handleImageClick(item)" :href="getCommonsUrl(item, posterMode, pixelatedEffect)"
                                class="clickable-image block w-full h-auto">
                                <template v-if="!posterMode && !item.logo">
                                    <div class="no-logo-placeholder bg-gray-200 dark:bg-gray-800 text-gray-400 rounded-md flex items-center justify-center aspect-[5/7.5] text-sm">
                                        (بدون لوگو)
                                    </div>
                                </template>
                                <template v-else>
                                    <img :src="getItemUrl(item, posterMode, pixelatedEffect)"
                                        :key="getItemUrl(item, posterMode, pixelatedEffect)" :alt="item.filmLabel"
                                        class="item-image w-full object-contain aspect-[5/7.5] rounded-md"
                                        :class="{ 'pixelated': pixelatedEffect && !item.logo && item.isNsfw && posterMode }" />
                                </template>
                            </a>
                            <a :href="downloadLink(item)" aria-label="دریافت پوستر" target="_blank"
                                class="download-btn absolute bottom-3 right-3 bg-black bg-opacity-70 text-white p-2 rounded-full text-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <span class="material-symbols-rounded">download</span>
                            </a>
                        </div>

                        <div class="item-title font-bold text-base mt-2 text-center leading-tight">
                            {{ item.filmLabel }}
                            <span class="year-link text-sm text-secondary cursor-pointer hover:underline"
                                @click.stop="selectYearFromTitle(toPersianYear(item.date))">
                                ({{ toPersianYear(item.date) }})
                            </span>
                        </div>

                        <div v-if="item.designers && item.designers.length > 0"
                            class="item-designer text-xs text-secondary mt-2 text-center">
                            <span class="sm:hidden material-symbols-rounded text-sm align-middle ml-1">person_edit</span>
                            <span class="hidden sm:inline">{{ item.designers.length === 1 ? 'طراح: ' : 'طراحان: ' }}</span>
                            <span v-for="(designer, index) in item.designers" :key="index" class="inline-block">
                                <a href="#" @click.prevent="selectDesigner(designer.label)"
                                    class="text-gray-800 dark:text-gray-100 hover:underline px-1">{{ designer.label }}</a>
                                <span class="item-links text-gray-500 dark:text-gray-400">
                                    <a :href="'https://www.wikidata.org/wiki/' + designer.id" aria-label="ویکی‌داده"
                                        target="_blank" class="inline-block mx-1">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/71/Wikidata.svg"
                                            alt="ویکی‌داده" class="linkIcon h-3.5 inline-block opacity-70 hover:opacity-100 transition-opacity">
                                    </a>
                                    <template v-if="designer.faWikipediaLink">
                                        <a :href="'https://fa.wikipedia.org/wiki/' + designer.faWikipediaLink.replaceAll(' ', '_')"
                                            aria-label="ویکی‌پدیا" target="_blank" class="inline-block mx-1">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Wikipedia_%22W%22_Rounded_White.svg"
                                                alt="ویکی‌پدیا" class="linkIcon h-3.5 inline-block opacity-70 hover:opacity-100 transition-opacity">
                                        </a>
                                    </template>
                                </span>
                                <br v-if="index < item.designers.length - 1 && item.designers.length > 1">
                            </span>
                        </div>
                    </div>
                    <div id="film-links"
                        class="item-links mt-3 p-2 bg-gray-100 dark:bg-gray-800 rounded-full text-sm font-semibold flex gap-2">
                        <a v-if="item.imdbID" :href="'https://www.imdb.com/title/' + item.imdbID" aria-label="IMDb"
                            target="_blank">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/IMDB_-_SuperTinyIcons.svg"
                                alt="IMDb" class="linkIcon h-4 opacity-70 hover:opacity-100 transition-opacity">
                        </a>
                        <a v-if="item.film" :href="'https://www.wikidata.org/wiki/' + item.film" aria-label="ویکی‌داده"
                            target="_blank">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/7/71/Wikidata.svg" alt="ویکی‌داده"
                                class="linkIcon h-4 opacity-70 hover:opacity-100 transition-opacity">
                        </a>
                        <a v-if="item.faWikipediaLink"
                            :href="'https://fa.wikipedia.org/wiki/' + item.faWikipediaLink.replaceAll(' ', '_')"
                            aria-label="ویکی‌پدیا" target="_blank">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Wikipedia_%22W%22_Rounded_White.svg"
                                alt="ویکی‌پدیا" class="linkIcon h-4 opacity-70 hover:opacity-100 transition-opacity">
                        </a>
                    </div>
                </div>
            </div>
            <p v-else class="text-center text-gray-500 py-10">
                نتیجه‌ای برای نمایش وجود ندارد.
            </p>
            <!-- Show More Button -->
            <div v-if="displayedItemsCount < filteredItems.length" class="text-center py-5">
                <button @click="showMore" id="show-more-button">
                    نمایش بیشتر ({{ Math.min(filteredItems.length - displayedItemsCount, 30).toLocaleString('fa') }})
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { createApp, ref, computed, watch, onMounted, nextTick, onUnmounted } from './vue.esm-browser.prod.min.js';

        // Fetch data
        const data = await (await fetch('./db.json', {
            method: 'GET',
            credentials: 'include',
            mode: 'no-cors',
        })).json();

        createApp({
            setup: () => {
                const darkMode = ref(false);
                const isShowMore = ref(false); // No longer needed as button is always there if items > displayed
                const designerQuery = ref(''); // Redundant with selectedDesigner and designerSearchQuery
                const isOptionsCollapsed = ref(true);
                const designerSearchQuery = ref('');
                const searchTerm = ref('');
                const selectedYear = ref('');
                const selectedDesigner = ref('');
                const selectedDirector = ref('');
                const selectedLetter = ref('');
                const posterMode = ref(true);
                const combineSimilarChars = ref(false);
                const pixelatedEffect = ref(false);
                const sortOrder = ref('random');
                const searchPlaceholder = ref('جستجو (برای پرش به کادر جستجو / را تایپ کنید)');
                const isSearchFocused = ref(false);
                const displayedItemsCount = ref(30);
                const exactWordMatch = ref(false);

                // Function to load more items
                const showMore = () => {
                    displayedItemsCount.value += 30;
                };

                // Search bar focus/blur handlers for placeholder text
                const onSearchFocus = () => {
                    isSearchFocused.value = true;
                    searchPlaceholder.value = 'جستجو';
                };
                const onSearchBlur = () => {
                    isSearchFocused.value = false;
                    searchPlaceholder.value = 'جستجو (برای پرش به کادر جستجو / را تایپ کنید)';
                };

                // Check if any filter is active
                const hasActiveFilters = computed(() => {
                    return searchTerm.value ||
                        selectedYear.value ||
                        selectedDesigner.value ||
                        selectedDirector.value ||
                        selectedLetter.value;
                });

                // Apply initial filters from URL parameters
                const applyInitialFilters = () => {
                    const urlParams = new URLSearchParams(window.location.search);
                    searchTerm.value = urlParams.get('q') || '';
                    selectedYear.value = urlParams.get('y') || '';
                    selectedDesigner.value = urlParams.get('designer') || '';
                    selectedDirector.value = urlParams.get('director') || '';
                    selectedLetter.value = urlParams.get('letter') || '';
                    posterMode.value = urlParams.get('mode') !== 'logo';
                    combineSimilarChars.value = urlParams.get('similar') === 'true';
                    pixelatedEffect.value = urlParams.get('censor') === null
                        ? location.hostname.endsWith('.ir')
                        : urlParams.get('censor') === 'true';
                    sortOrder.value = urlParams.get('sort') || 'random';
                };
                applyInitialFilters();

                // Update URL parameters based on filter changes
                const updateURL = () => {
                    const params = new URLSearchParams();
                    if (searchTerm.value) params.set('q', searchTerm.value);
                    if (selectedYear.value) params.set('y', selectedYear.value);
                    if (selectedDesigner.value) params.set('designer', selectedDesigner.value);
                    if (selectedDirector.value) params.set('director', selectedDirector.value);
                    if (selectedLetter.value) params.set('letter', selectedLetter.value);
                    params.set('mode', posterMode.value ? 'poster' : 'logo');
                    params.set('similar', combineSimilarChars.value ? 'true' : 'false');
                    params.set('censor', pixelatedEffect.value ? 'true' : 'false');
                    params.set('sort', sortOrder.value);

                    const newUrl = `${window.location.pathname}?${params.toString()}`;
                    window.history.pushState({}, '', newUrl);
                };
                watch([
                    searchTerm, selectedYear, selectedDesigner, selectedDirector,
                    selectedLetter, posterMode, combineSimilarChars, pixelatedEffect, sortOrder
                ], updateURL);

                // Sidebar section collapse state
                const isCollapsed = ref({
                    designers: false,
                    directors: true,
                    years: false,
                    letters: true
                });

                // Computed class for sidebar sections based on collapse state
                const getSectionClass = section => isCollapsed.value[section] ? 'collapsed' : 'expanded';

                // Select functions for modal filters
                const selectDirectorFromModal = director => selectedDirector.value = director;
                const selectYearFromModal = year => selectedYear.value = year;
                const selectLetterFromModal = letter => selectedLetter.value = letter;

                // Toggle poster/logo mode
                const togglePosterMode = () => {
                    posterMode.value = !posterMode.value;
                    document.body.setAttribute('data-mode', posterMode.value ? 'poster' : 'logo');
                };

                // Toggle options section visibility (mobile)
                const toggleOptions = () => isOptionsCollapsed.value = !isOptionsCollapsed.value;
                // Computed class for collapse icon rotation
                const collapseIconClass = value => value ? 'rotate-down' : 'rotate-up';

                // Select a designer and apply filters (redundant, but keeping for now)
                const selectDesigner = designer => {
                    selectedDesigner.value = designer;
                    designerQuery.value = designer;
                    // applyFilters(); // This function was simple filter by designer, now handled by filteredItems computed
                };

                // Reset all filters
                const resetFilters = () => {
                    searchTerm.value = '';
                    combineSimilarChars.value = false;
                    sortOrder.value = 'random';
                    selectedYear.value = '';
                    selectedDesigner.value = '';
                    selectedDirector.value = '';
                    selectedLetter.value = '';
                };

                // Total film count and unique film count for current results
                const films = Object.values(data.films);
                const uniqueFilmCount = computed(() => films.length.toLocaleString('fa', { useGrouping: false }));

                const uniqueResultsFilmCount = computed(() => {
                    const uniqueFilmIds = new Set(filteredItems.value.map(item => item.film));
                    return uniqueFilmIds.size.toLocaleString('fa', { useGrouping: false });
                });

                // Transform raw film data into flattened items
                const items = films.flatMap(film => {
                    return film.posters.map((poster, i) => {
                        const item = {};
                        item.film = film.id;
                        if (!film.labels.fa) {
                            console.log(film.id + ' doesn\'t have Persian label!');
                        }
                        item.filmLabel = film.labels.fa || film.labels.en || '';
                        item.aliases = film.aliases?.fa?.join(',') ?? '';
                        item.date = film.date
                            .map(x => x.replace(/^\+/, '')
                                .replace('-01-01T00:00:00Z', '-03-30T00:00:00Z')
                                .replace('-00-00T00:00:00Z', '-03-30T00:00:00Z')
                                .replace('-00T', '-01T')
                            )
                            .sort((a, b) => new Date(a).getTime() - new Date(b).getTime())[0];
                        item.poster = poster.image;
                        item.posterHash = poster.hash;
                        item.isNsfw = poster.characteristics?.includes('Q2716583') ?? false;
                        if (poster.designers?.length ?? 0) {
                            item.designers = poster.designers.map(designerId => {
                                const designer = data.secondary[designerId];
                                return {
                                    id: designerId,
                                    label: designer.labels.fa,
                                    faWikipediaLink: designer.sitelinks?.fawiki
                                };
                            });
                            item.characteristics = poster.characteristics;
                            item.designerLabel = data.secondary[poster.designers[0]].labels.fa;
                            const fawiki = data.secondary[poster.designers[0]].sitelinks.fawiki;
                            if (fawiki) item.designerFaWikipediaLink = fawiki;
                        }
                        if (film.directors.length) {
                            item.director = film.directors[0];
                            item.directorLabel = data.secondary[film.directors[0]].labels.fa;
                        }
                        if (film.imdb.length) {
                            item.imdbID = film.imdb[0];
                        }
                        item.faWikipediaLink = film.sitelinks.fawiki;
                        if (film.logos.length > i) {
                            item.logo = film.logos[i].image;
                            item.logoHash = film.logos[i].hash;
                        }
                        return item;
                    });
                });
                const itemsLength = computed(() => items.length.toLocaleString('fa', { useGrouping: false }));

                // Similar characters mapping for search
                const similarCharsMapping = {
                    'آ': '[آاأإ]', 'ا': '[آاأإ]', 'أ': '[آاأإ]', 'إ': '[آاأإ]', 'ط': '[طظ]', 'ظ': '[طظ]', 'ب': '[بپتثنی]', 'پ': '[بپتثنی]',
                    'ت': '[بپتثنی]', 'ث': '[بپتثنی]', 'ن': '[بپتثنی]', 'ی': '[بپتثنی]', 'ج': '[جچحخ]',
                    'چ': '[جچحخ]', 'ح': '[جچحخ]', 'خ': '[جچحخ]', 'د': '[دذ]',
                    'ذ': '[دذ]', 'ر': '[رزژ]', 'ز': '[رزژ]', 'ژ': '[رزژ]', 'س': '[سش]',
                    'ش': '[سش]', 'ص': '[صض]', 'ض': '[صض]', 'ع': '[عغ]',
                    'غ': '[عغ]', 'ف': '[فق]', 'ق': '[فق]', 'ک': '[کگ]',
                    'گ': '[کگ]'
                };

                const persianAlphabet = [
                    'آ', 'ا', 'ب', 'پ', 'ت', 'ث', 'ج', 'چ', 'ح', 'خ', 'د', 'ذ', 'ر', 'ز', 'ژ', 'س', 'ش', 'ص', 'ض', 'ط', 'ظ', 'ع', 'غ', 'ف', 'ق', 'ک', 'گ', 'ل', 'م', 'ن', 'و', 'ه', 'ی'
                ];

                // Convert Gregorian date to Persian year
                const toPersianYear = date => {
                    const year = new Date(date).toLocaleDateString('fa').split('/')[0];
                    return year === 'Invalid Date' ? 'نامشخص' : year;
                };

                // Available years (for sidebar filter)
                const availableYears = computed(() => {
                    const groups = Object.groupBy(items, item => toPersianYear(item.date));
                    return Object.keys(groups).sort().map(year => [year, groups[year].length.toLocaleString('fa')]);
                });

                // Available designers (for sidebar filter)
                const availableDesigners = computed(() => {
                    const groups = Object.groupBy(items.filter(x => x.designerLabel), item => item.designerLabel);
                    return Object.keys(groups)
                        .map(designer => [designer, groups[designer].length])
                        .sort((a, b) => b[1] - a[1])
                        .map(([designer, count]) => [designer, count.toLocaleString('fa')]);
                });

                // Available directors (for sidebar filter)
                const availableDirectors = computed(() => {
                    const groups = Object.groupBy(items.filter(x => x.directorLabel), item => item.directorLabel);
                    return Object.keys(groups)
                        .map(director => [director, groups[director].length])
                        .sort((a, b) => b[1] - a[1])
                        .map(([director, count]) => [director, count.toLocaleString('fa')]);
                });

                // Get item title with year (for display)
                const getItemTitleWithYear = item => {
                    return item.filmLabel + (item.date ? ` (${toPersianYear(item.date)})` : '');
                };

                // Letter counts (for sidebar filter)
                const letterCounts = computed(() => {
                    const counts = persianAlphabet.reduce((acc, letter) => {
                        acc[letter] = items.filter(item => item.filmLabel.startsWith(letter)).length;
                        return acc;
                    }, {});
                    return counts;
                });

                // Main computed property for filtered and sorted items
                const filteredItems = computed(() => {
                    let results = items;

                    const trimmedSearchTerm = searchTerm.value
                        .replace(/^[\s\u200C]+|[\s\u200C]+$/g, '')
                        .trim();

                    if (trimmedSearchTerm.length) {
                        let modifiedSearchTerm;

                        if (exactWordMatch.value) {
                            modifiedSearchTerm = trimmedSearchTerm
                                .split('')
                                .map(char => combineSimilarChars.value
                                    ? (similarCharsMapping[char] || char)
                                    : char)
                                .join('');

                            modifiedSearchTerm = `(^|\\s)${modifiedSearchTerm}(?=\\s|$|\\p{P})`;
                        } else {
                            modifiedSearchTerm = trimmedSearchTerm
                                .split('')
                                .map(char => combineSimilarChars.value
                                    ? (similarCharsMapping[char] || char)
                                    : char)
                                .join('');
                        }

                        try {
                            const regex = new RegExp(modifiedSearchTerm, 'iu');
                            results = results.filter(item =>
                                regex.test(item.filmLabel) ||
                                regex.test(item.aliases || '')
                            );
                        } catch (e) {
                            console.error("Error in regex:", e);
                        }
                    }

                    if (selectedYear.value) {
                        results = results.filter(item => toPersianYear(item.date) === selectedYear.value);
                    }

                    if (selectedDesigner.value) {
                        results = results.filter(item =>
                            item.designers && item.designers.some(designer => designer.label === selectedDesigner.value)
                        );
                    }

                    if (selectedDirector.value) {
                        results = results.filter(item => item.directorLabel === selectedDirector.value);
                    }

                    if (selectedLetter.value) {
                        results = results.filter(item => item.filmLabel.startsWith(selectedLetter.value));
                    }

                    if (sortOrder.value === 'alphabetical') {
                        results = results.sort((a, b) => a.filmLabel.localeCompare(b.filmLabel, 'fa'));
                    } else if (sortOrder.value === 'year') {
                        results = results.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
                    } else if (sortOrder.value === 'random') {
                        results = results.slice().sort(() => Math.random() - 0.5);
                    }

                    return results;
                });

                // Watcher for designerQuery (redundant with selectedDesigner)
                watch(designerQuery, newValue => {
                    if (!newValue) {
                        selectedDesigner.value = '';
                    }
                });

                // Filtered years for sidebar (based on current filtered items)
                const filteredYears = computed(() => {
                    const groups = Object.groupBy(filteredItems.value, item => toPersianYear(item.date));
                    return Object.keys(groups)
                        .sort()
                        .map(year => [year, groups[year].length.toLocaleString('fa')]);
                });

                // Filtered designers for sidebar (based on current filtered items)
                const filteredDesigners = computed(() => {
                    const groups = Object.groupBy(filteredItems.value.filter(x => x.designerLabel), item => item.designerLabel);
                    return Object.keys(groups)
                        .map(designer => [designer, groups[designer].length])
                        .sort((a, b) => b[1] - a[1])
                        .map(([designer, count]) => [designer, count.toLocaleString('fa')]);
                });

                // Filtered directors for sidebar (based on current filtered items)
                const filteredDirectors = computed(() => {
                    const groups = Object.groupBy(filteredItems.value.filter(x => x.directorLabel), item => item.directorLabel);
                    return Object.keys(groups)
                        .map(director => [director, groups[director].length])
                        .sort((a, b) => b[1] - a[1])
                        .map(([director, count]) => [director, count.toLocaleString('fa')]);
                });

                // Filtered designers for modal (search within current filtered items)
                const filteredDesignersInModal = computed(() => {
                    const groups = Object.groupBy(filteredItems.value.filter(x => x.designerLabel), item => item.designerLabel);
                    const designers = Object.keys(groups)
                        .map(designer => [designer, groups[designer].length])
                        .sort((a, b) => b[1] - a[1])
                        .map(([designer, count]) => [designer, count.toLocaleString('fa')]);

                    if (!designerSearchQuery.value) {
                        return designers;
                    }
                    return designers.filter(([designer]) =>
                        designer.includes(designerSearchQuery.value)
                    );
                });

                // Select designer from modal (updates selectedDesigner)
                const selectDesignerFromModal = designer => {
                    selectedDesigner.value = designer;
                    designerQuery.value = designer; // Keep this for consistency with original code, though might be redundant
                };

                // Filtered years for modal (based on current filtered items)
                const filteredYearsInModal = computed(() => {
                    const groups = Object.groupBy(filteredItems.value, item => toPersianYear(item.date));
                    return Object.keys(groups)
                        .sort()
                        .map(year => [year, groups[year].length.toLocaleString('fa')]);
                });

                // Watcher to reset displayed items count when filters change
                watch(filteredItems, (newValue) => {
                    displayedItemsCount.value = 30;
                });

                const directorSearchQuery = ref('');

                // Filtered directors for modal (search within current filtered items)
                const filteredDirectorsInModal = computed(() => {
                    const groups = Object.groupBy(filteredItems.value.filter(x => x.directorLabel), item => item.directorLabel);
                    const directors = Object.keys(groups)
                        .map(director => [director, groups[director].length])
                        .sort((a, b) => b[1] - a[1])
                        .map(([director, count]) => [director, count.toLocaleString('fa')]);

                    if (!directorSearchQuery.value) {
                        return directors;
                    }
                    return directors.filter(([director]) =>
                        director.includes(directorSearchQuery.value)
                    );
                });

                // Filtered letters for modal (based on current filtered items)
                const filteredLettersInModal = computed(() => {
                    const groups = Object.groupBy(filteredItems.value, item => item.filmLabel[0]);

                    const letters = persianAlphabet
                        .filter(letter => groups[letter])
                        .map(letter => [letter, groups[letter].length.toLocaleString('fa')]);

                    return letters;
                });

                // Labels for selected filters in sidebar headers
                const filteredYearLabel = computed(() => selectedYear.value ? `سال: ${selectedYear.value}` : 'سال‌ها');
                const filteredDesignerLabel = computed(() => selectedDesigner.value ? `طراح: ${selectedDesigner.value}` : 'طراحان');
                const filteredDirectorLabel = computed(() => selectedDirector.value ? `کارگردان: ${selectedDirector.value}` : 'کارگردان‌ها');
                const filteredLetterLabel = computed(() => selectedLetter.value ? `حرف اول: ${selectedLetter.value}` : 'حروف اول');

                // Sidebar resizing functionality
                const sidebarWidth = ref(385); // Default width adjusted for better mobile fit
                const minSidebarWidth = ref(300);
                const maxSidebarWidth = ref(600);

                let startX, startWidth;
                const startResize = e => {
                    e.preventDefault();
                    startX = e.clientX;
                    startWidth = sidebarWidth.value;
                    document.addEventListener('mousemove', resize);
                    document.addEventListener('mouseup', stopResize);
                };

                const resize = e => {
                    const newWidth = startWidth + (startX - e.clientX);
                    if (newWidth >= minSidebarWidth.value && newWidth <= maxSidebarWidth.value) {
                        sidebarWidth.value = newWidth;
                    }
                };

                const stopResize = () => {
                    document.removeEventListener('mousemove', resize);
                    document.removeEventListener('mouseup', stopResize);
                };

                onMounted(() => {
                    const resizeHandle = document.querySelector('.sidebar-resize-handle');
                    if (resizeHandle) {
                        resizeHandle.addEventListener('mousedown', startResize);
                    } else {
                        console.log('Resize handle element not found!');
                    }
                });

                // Hover state for filter items
                const hoveredItem = ref(null);

                // Functions to remove individual filters
                const removeYearFilter = () => {
                    selectedYear.value = '';
                    hoveredItem.value = null;
                };

                const removeDesignerFilter = () => {
                    selectedDesigner.value = '';
                    hoveredItem.value = null;
                };

                const removeDirectorFilter = () => {
                    selectedDirector.value = '';
                    hoveredItem.value = null;
                };

                const removeLetterFilter = () => {
                    selectedLetter.value = '';
                    hoveredItem.value = null;
                };

                // Sidebar visibility (mobile)
                const sidebarVisible = ref(false);

                const toggleSidebar = () => {
                    sidebarVisible.value = !sidebarVisible.value;
                    if (sidebarVisible.value) {
                        // Push a new state to handle back button for closing sidebar
                        window.history.pushState({ sidebarOpen: true }, '', window.location.pathname + '#sidebar');
                    } else {
                        // If sidebar is being closed and the current history state was ours, pop it
                        if (window.history.state && window.history.state.sidebarOpen) {
                            window.history.back();
                        }
                    }
                };

                const hideSidebar = () => {
                    sidebarVisible.value = false;
                    // If sidebar is being closed and the current history state was ours, pop it
                    if (window.history.state && window.history.state.sidebarOpen) {
                        window.history.back();
                    }
                };

                // Handle browser back button for sidebar
                onMounted(() => window.addEventListener('popstate', handlePopState));
                onUnmounted(() => window.removeEventListener('popstate', handlePopState));

                const handlePopState = e => {
                    if (sidebarVisible.value && !(e.state && e.state.sidebarOpen)) {
                        sidebarVisible.value = false;
                    } else if (!sidebarVisible.value && (e.state && e.state.sidebarOpen)) {
                        // This case might happen if user navigated back from another page to ours
                        // and we want to ensure sidebar is visible if the state says so.
                        sidebarVisible.value = true;
                    }
                };

                // Clear search inputs
                const clearSearchTerm = () => searchTerm.value = '';
                const clearDesignerSearchQuery = () => designerSearchQuery.value = '';
                const clearDirectorSearchQuery = () => directorSearchQuery.value = '';

                // Toggle sidebar section collapse
                const toggleCollapse = section => isCollapsed.value[section] = !isCollapsed.value[section];

                // Lightbox state
                const lightboxItem = ref(undefined);
                const lightboxImage = ref(undefined);
                const isLoading = ref(false);

                // Open lightbox and preload images
                const openLightbox = item => {
                    if (!posterMode.value && !item.logo) {
                        lightboxImage.value = undefined;
                        lightboxItem.value = undefined;
                        return;
                    }
                    isLoading.value = true;
                    lightboxImage.value = posterMode.value ? getPosterUrl(item.poster, item.posterHash, 960) : getPosterUrl(item.logo, item.logoHash, 960);
                    lightboxItem.value = item;

                    const currentIndex = filteredItems.value.findIndex(i => i === item);
                    preloadImages(currentIndex);

                    // Simulate loading delay for spinner
                    setTimeout(() => {
                        isLoading.value = false;
                    }, 500); // Reduced delay for faster UX
                };

                // Close lightbox
                const closeLightbox = () => {
                    lightboxItem.value = undefined;
                    isLoading.value = false;
                };

                // Watcher for lightboxItem to add/remove click outside listener
                watch(lightboxItem, newValue => {
                    if (newValue) {
                        document.addEventListener('click', handleClickOutsideLightbox);
                    } else {
                        document.removeEventListener('click', handleClickOutsideLightbox);
                    }
                });

                // Handle clicks outside the lightbox image to close it
                const handleClickOutsideLightbox = event => {
                    const lightbox = document.querySelector('.lightbox');
                    // Check if the click occurred outside the image itself, but within the lightbox container.
                    // Also ensure it's not on the navigation buttons.
                    if (lightbox && !event.target.closest('.lightbox img') && !event.target.closest('.lightbox-button')) {
                        closeLightbox();
                    }
                };

                // Handle image click to open lightbox
                const handleImageClick = item => {
                    // Do not interfere with non-left clicks or if modifier keys are pressed.
                    if ((event.button !== 0 && event.which !== 1) ||
                        event.altKey || event.ctrlKey || event.shiftKey || event.metaKey) {
                        return true;
                    }

                    event.preventDefault();
                    event.stopPropagation();
                    openLightbox(item);
                };

                // Change lightbox image (next/prev)
                const changeLightboxImage = changeIndexCallback => {
                    isLoading.value = true;
                    const currentIndex = filteredItems.value.findIndex(item => item.poster === lightboxItem.value.poster);
                    const newIndex = changeIndexCallback(currentIndex, filteredItems.value.length - 1);
                    lightboxItem.value = filteredItems.value[newIndex];
                    lightboxImage.value = posterMode.value
                        ? getPosterUrl(lightboxItem.value.poster, lightboxItem.value.posterHash, 960)
                        : getPosterUrl(lightboxItem.value.logo, lightboxItem.value.logoHash, 960);

                    preloadImages(newIndex);

                    setTimeout(() => isLoading.value = false, 500); // Reduced delay
                };
                const prevImage = () => changeLightboxImage((current, lastItem) => current <= 0 ? lastItem : current - 1);
                const nextImage = () => changeLightboxImage((current, lastItem) => current >= lastItem ? 0 : current + 1);

                // Keyboard navigation for lightbox
                onMounted(() => {
                    window.addEventListener('keydown', handleKeyDown);
                });
                onUnmounted(() => {
                    window.removeEventListener('keydown', handleKeyDown);
                });

                const handleKeyDown = (event) => {
                    if (lightboxItem.value) {
                        if (event.key === 'ArrowLeft') {
                            nextImage();
                        } else if (event.key === 'ArrowRight') {
                            prevImage();
                        } else if (event.key === 'Escape') {
                            closeLightbox();
                        }
                    } else if (event.key === '/' && !['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) {
                        event.preventDefault();
                        const searchInput = document.querySelector('input[type="text"][placeholder*="پرش"]');
                        if (searchInput) {
                            searchInput.focus();
                        }
                    }
                };

                // Image preloading
                const preloadedImages = ref({}); // Not explicitly used but kept for context if needed
                const preloadNext = ref(null);
                const preloadPrev = ref(null);

                const preloadImages = (currentIndex) => {
                    const nextIndex = currentIndex + 1 < filteredItems.value.length ? currentIndex + 1 : 0;
                    const prevIndex = currentIndex - 1 >= 0 ? currentIndex - 1 : filteredItems.value.length - 1;

                    const nextItem = filteredItems.value[nextIndex];
                    const prevItem = filteredItems.value[prevIndex];

                    if (nextItem) {
                        preloadNext.value = new Image();
                        preloadNext.value.src = posterMode.value ? getPosterUrl(nextItem.poster, nextItem.posterHash, 960) : getPosterUrl(nextItem.logo, nextItem.logoHash, 960);
                    }

                    if (prevItem) {
                        preloadPrev.value = new Image();
                        preloadPrev.value.src = posterMode.value ? getPosterUrl(prevItem.poster, prevItem.posterHash, 960) : getPosterUrl(prevItem.logo, prevItem.logoHash, 960);
                    }
                };

                // Generate download link for image
                const downloadLink = item => {
                    const name = posterMode.value ? item.poster : item.logo;
                    if (!name) return 'https://upload.wikimedia.org/wikipedia/commons/8/82/NoImageEn.svg';
                    const hash = posterMode.value ? item.posterHash : item.logoHash;
                    return `https://upload.wikimedia.org/wikipedia/commons/${hash[0]}/${hash}/${name}?download`;
                };

                // Select year from item title click
                const selectYearFromTitle = year => selectedYear.value = year;

                // Active filters array for display
                const activeFilters = computed(() => {
                    const filters = [];
                    if (searchTerm.value) { // Add search term as a filter
                        filters.push({ type: 'search', label: 'جستجو', value: searchTerm.value });
                    }
                    if (selectedYear.value) {
                        filters.push({ type: 'year', label: 'سال', value: selectedYear.value });
                    }
                    if (selectedDesigner.value) {
                        filters.push({ type: 'designer', label: 'طراح', value: selectedDesigner.value });
                    }
                    if (selectedDirector.value) {
                        filters.push({ type: 'director', label: 'کارگردان', value: selectedDirector.value });
                    }
                    if (selectedLetter.value) {
                        filters.push({ type: 'letter', label: 'حرف اول', value: selectedLetter.value });
                    }
                    return filters;
                });

                // Remove filter from active filters
                const removeFilter = (type, value) => {
                    switch (type) {
                        case 'search':
                            searchTerm.value = '';
                            break;
                        case 'year':
                            selectedYear.value = '';
                            break;
                        case 'designer':
                            selectedDesigner.value = '';
                            break;
                        case 'director':
                            selectedDirector.value = '';
                            break;
                        case 'letter':
                            selectedLetter.value = '';
                            break;
                    }
                };

                // Filtered items length (for display)
                const filteredItemsLength = computed(() => {
                    return filteredItems.value.length.toLocaleString('fa', { useGrouping: false });
                });

                // Get poster URL with specified width
                const getPosterUrl = (name, hash, width) => {
                    if (!name) return 'https://upload.wikimedia.org/wikipedia/commons/8/82/NoImageEn.svg';
                    return `https://upload.wikimedia.org/wikipedia/commons/thumb/${hash[0]}/${hash}/${name}/${width}px-${name}`;
                };

                // Get item image URL (poster/logo, pixelated effect)
                const getItemUrl = (item, posterMode, pixelatedEffect) => {
                    if (!posterMode && !item.logo) return null;
                    if (posterMode && pixelatedEffect && item.isNsfw && item.logo) return getPosterUrl(item.logo, item.logoHash, 250);
                    return posterMode ? getPosterUrl(item.poster, item.posterHash, 250) : getPosterUrl(item.logo, item.logoHash, 250);
                };

                // Get Wikimedia Commons URL for item
                const getCommonsUrl = (item, posterMode, pixelatedEffect) => {
                    if (!posterMode && !item.logo) return '#';
                    return 'https://commons.wikimedia.org/wiki/File:' + (posterMode ? item.poster : item.logo);
                };

                // Scroll to top functionality
                const bringToTop = () => document.documentElement.scrollTop = 0;
                const visibleBringToTop = ref(false);

                window.addEventListener('scroll', () => {
                    visibleBringToTop.value = document.documentElement.scrollTop > 20;
                });
                
                // Dark mode toggle (not used in current HTML, but kept for future expansion)
                const toggleDarkMode = () => {
                    darkMode.value = !darkMode.value;
                    document.body.setAttribute('data-theme', darkMode.value ? 'dark' : 'light');
                };
                
                // Initial dark mode setup based on system preference
                onMounted(() => {
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        darkMode.value = true;
                        document.body.setAttribute('data-theme', 'dark');
                    } else {
                        document.body.setAttribute('data-theme', 'light');
                    }
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                        darkMode.value = event.matches;
                        document.body.setAttribute('data-theme', darkMode.value ? 'dark' : 'light');
                    });
                });


                return {
                    showMore, isShowMore, searchTerm, combineSimilarChars, posterMode, filteredItems, items,
                    getItemUrl, getCommonsUrl, getItemTitleWithYear, darkMode, toggleDarkMode, sortOrder, selectedYear,
                    availableYears, availableDesigners, selectedDesigner, filteredYears, bringToTop, visibleBringToTop,
                    filteredDesigners, designerQuery, selectDesigner, filteredDirectors, availableDirectors,
                    selectedDirector, persianAlphabet, selectedLetter, letterCounts, resetFilters, togglePosterMode,
                    toggleOptions, isOptionsCollapsed, collapseIconClass, filteredDesignersInModal, designerSearchQuery,
                    selectDesignerFromModal, filteredDirectorsInModal, selectDirectorFromModal, filteredYearsInModal,
                    selectYearFromModal, filteredLettersInModal, selectLetterFromModal, isCollapsed, toggleCollapse,
                    filteredYearLabel, filteredDesignerLabel, filteredDirectorLabel, filteredLetterLabel, getSectionClass,
                    directorSearchQuery, sidebarWidth, minSidebarWidth, maxSidebarWidth, removeYearFilter,
                    removeDesignerFilter, removeDirectorFilter, removeLetterFilter, hoveredItem, hideSidebar,
                    sidebarVisible, uniqueFilmCount, toggleSidebar, pixelatedEffect, clearSearchTerm, lightboxItem,
                    lightboxImage, openLightbox, closeLightbox, downloadLink, handleImageClick,
                    clearDesignerSearchQuery, clearDirectorSearchQuery, selectYearFromTitle, toPersianYear, isLoading,
                    handlePopState, activeFilters, removeFilter, filteredItemsLength, itemsLength, prevImage, nextImage,
                    searchPlaceholder, onSearchFocus, onSearchBlur, displayedItemsCount, uniqueResultsFilmCount,
                    hasActiveFilters, exactWordMatch
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
