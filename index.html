<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">
<meta name="title" content="Film Posters of Iran | آرشیو پوسترهای سینمای ایران">
<meta name="description" content="آرشیو پوستر فیلم‌های سینمایی ایرانی قبل و بعد از انقلاب؛ دربردارندهٔ آثار محمدعلی باطنی، محمدعلی حدت، محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی و دیگر طراحان گرافیک.">
<meta name="keywords" content="پوستر فیلم, فیلم ایرانی, پوستر سینمایی, محمدعلی باطنی, محمدعلی حدت, محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی، قباد شیوا، فرشید مثقالی، جشنواره فیلم فجر، دانلود پوستر فیلم، عباس کیارستمی film posters of Iran, Iranian films">
<meta property="twitter:title" content="Film Posters of Iran | آرشیو پوسترهای سینمای ایران">
<meta property="twitter:description" content="آرشیو پوستر فیلم‌های سینمایی ایرانی قبل و بعد از انقلاب؛ دربردارندهٔ آثار محمدعلی باطنی، محمدعلی حدت، محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی و دیگر طراحان گرافیک">
<meta property="og:title" content="Film Posters of Iran | آرشیو پوسترهای سینمای ایران" />
<meta property="og:site_name" content="آرشیو پوسترهای سینمای ایران"/>
<meta property="og:description" content="آرشیو پوستر فیلم‌های سینمایی ایرانی قبل و بعد از انقلاب؛ دربردارندهٔ آثار محمدعلی باطنی، محمدعلی حدت، محسن دولو، مسعود بهنام، مرتضی ممیز، ابراهیم حقیقی و دیگر طراحان گرافیک" />
<title>آرشیو پوسترهای سینمای ایران</title>
<link rel="icon" href="favicon.svg">
<style>
* {
	font-family: system-ui;
	box-sizing: border-box;
}

@font-face {
	font-family: 'Material Symbols Rounded';
	/* https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded&icon_names=arrow_back_ios,arrow_forward_ios,close,download,info,keyboard_arrow_up,menu,north,person_edit,refresh,swap_vert */
	src: url(data:application/octet-stream;base64,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) format('woff');
}

.material-symbols-rounded {
	font-family: 'Material Symbols Rounded';
	font-size: 24px;
	display: inline-block;
	white-space: nowrap;
	line-height: 1;
}

html {
	scroll-behavior: smooth;
	--body-background: light-dark(#eee, #121212);
	--body-foreground: light-dark(black, #e0e0e0);
	--search-background: light-dark(#fff, #222);
	--text-input-border: #ccc;
	--card-background: light-dark(#fff, #222);
	--year-link-foreground: light-dark(#555, #adadad);
	--bar-color: light-dark(#b77, #b77);
	--bar-hover-color: light-dark(#a66, #a66);
	--svg-background: light-dark(#fff, #000);
	--svg-border-color: light-dark(#ddd, #333);
	--axis-text-color: light-dark(black, #e0e0e0);
}

body {
	display: flex;
	justify-content: flex-start;
	align-items: flex-start;
	min-height: 100vh;
	background-color: var(--body-background);
	color: var(--body-foreground);
	margin: 0;
	transition: background-color 0.3s, color 0.3s;
	overflow-x: hidden;
}

#app {
	display: flex;
	flex: 1;
	width: 100%;
	padding: 20px;
	transition: background-color 0.3s, color 0.3s;
}

#main-content {
	flex: 1;
	width: 100%;
	display: flex;
	flex-direction: column;
	align-items: center;
	max-width: 100%;
	overflow-x: hidden;
	/* پدینگ بالا توسط اسکریپت به صورت پویا مدیریت می‌شود تا با ارتفاع نوار جستجو هماهنگ باشد */
	padding-top: 30px;
	transition: padding-top 0.3s ease-in-out, margin-right 0.3s ease-in-out;
}

.search-container {
	display: flex;
	align-items: center;
	gap: 10px;
	margin-bottom: 10px;
	position: relative;
}

.search-bar {
	position: fixed;
	top: -120px;
	z-index: 100;
	opacity: 0;
	transition: top 0.3s ease-in-out, opacity 0.3s ease-in-out, left 0.3s ease-in-out, width 0.3s ease-in-out, right 0.3s ease-in-out;
	padding: 0px 60px;
}

.search-bar-inner {
	max-width: 960px;
	width: 100%;
	margin: 0 auto;
	padding: 10px;
	border-radius: 0 0 16px 16px;
	box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	background-color: var(--search-background);
}

.search-bar.visible {
	top: 0px;
	opacity: 1;
}

input[type="text"] {
	width: 100%;
	padding: 10px;
	border: 1px solid var(--text-input-border);
	border-radius: 12px;
}

.options {
	display: flex;
	flex-wrap: wrap;
	column-gap: 20px;
	row-gap: 10px;
	justify-content: space-around;
	margin: 10px 0 10px;
	border: none;
	align-items: center;
}

.results-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
	justify-content: center;
	gap: 15px;
	max-width: 1520px;
	width: 100%;
	z-index: 1;
	padding-right: 60px;
	padding-left: 60px;
}

.item-card {	
	text-align: center;
	padding: 15px 5px;
	background: var(--card-background);
	border-radius: 12px;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	align-items: center;
	transition: background-color 0.3s, border-color 0.3s;
	position: relative;
}

.item-card.minimal {
	padding: 0;
	background: none;
	border: none;
}

.item-image {
	width: 100%;
	object-fit: contain;
	aspect-ratio: 5 / 7.5;
	margin-bottom: 10px;
	transition: filter 0.3s;
}

.item-image.no-logo-bw {
	filter: grayscale(100%) contrast(1.5);
	image-rendering: pixelated;
}

.item-title {
	font-weight: bold;
}

.item-title.minimal {
	color: var(--body-foreground);
	margin-top: 10px;
	padding: 0 5px;
}

.year-link {
	color: var(--year-link-foreground);
	cursor: pointer;
	text-decoration: none;
	margin-right: 3px;
	font-weight: normal;
}

.year-link:hover {
	text-decoration: underline;
}

.item-designer {
	font-size: 0.85em;
	color: light-dark(#555, #adadad);
	margin-top: 10px;
}

.item-designer a {
	color: light-dark(#222, #ddd);
	text-decoration: none;
	margin-left: 4px;
}

.item-designer a:hover {
	text-decoration: underline;
}

.item-links {
	margin-top: 10px;
}

.item-links a {
	color: light-dark(#555, #bbb);
	text-decoration: none;
	margin: 0 5px;
}

.item-links a:hover {
	text-decoration: underline;
}

#film-links {
	background: light-dark(#eee, #333);
	padding: 3px 8px;
	border-radius: 40px;
	font-weight: bold;
}

.linkIcon {
	opacity: 0.7;
	height: 14px;
	transition: 0.1s;
}

.linkIcon:hover {
	opacity: 1;
}

.image-container {
	position: relative;
	width: 100%;
	display: flex;
	justify-content: center;
	align-items: center;
}

.download-btn {
	position: absolute;
	bottom: 20px;
	right: 10px;
	background-color: rgba(0, 0, 0, 0.7);
	color: white;
	border: none;
	padding: 8px 12px;
	border-radius: 5px;
	cursor: pointer;
	opacity: 0;
	transition: opacity 0.3s;
	z-index: 10;
}

.image-container:hover .download-btn {
	opacity: 1;
}

.clickable-image {
	display: block;
	width: 100%;
	height: auto;
	z-index: 2;
}

.no-logo-placeholder {
	height: 50px;
	border: 1px light-dark(#eee, #333) solid;
	display: flex;
	justify-content: center;
	align-items: center;
	border-radius: 4px;
	color: light-dark(#ccc, #555);
	margin-bottom: 10px;
}

.lightbox {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.8);
	display: flex;
	justify-content: center;
	align-items: center;
	z-index: 1000;
}

.lightbox img {
	max-width: 90%;
	max-height: 90%;
	border-radius: 10px;
	z-index: 2;
	background-color: #fff; /* پس‌زمینه پیش‌فرض سفید */
}

.loading-spinner {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	z-index: 1;
}

.lightbox-button {
	position: absolute;
	background: none;
	border: none;
	padding: 28px 30px;
	cursor: pointer;
	z-index: 1000;
	color: light-dark(#fff, #fff);
	border-radius: 60px;
}

.lightbox-button:hover {
	background: #fff4;
}

.lightbox-info {
	position: absolute;
	bottom: 20px;
	right: 20px;
	background-color: #888a;
	color: white;
	padding: 20px;
	border-radius: 12px;
	max-width: 80%;
	text-align: right;
}
	
.lightbox-info h2 {
	margin: 0;
	font-size: 1.5em;
}
	
.lightbox-info p {
	margin: 5px 0;
	font-size: 1em;
}

#toTop {
	transition: bottom ease-in-out 350ms, opacity linear 350ms;
	bottom: -100px;
	width: 52px;
	height: 52px;
	position: fixed;
	left: 30px;
	z-index: 99;
	font-size: 18px;
	border: none;
	outline: none;
	background-color: gray;
	color: white;
	cursor: pointer;
	padding: 15px;
	border-radius: 10px;
}

#toTop:hover {
	opacity: 60%;
	box-shadow: 0px 4px 10px gray;
	transition-duration: 0.1s;
}

#resetSearch {
	border: none;
	color: white;
	padding: 6px 6px 4px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	cursor: pointer;
	border-radius: 20px;
	background-color: gray;
	opacity: 80%;
	transition-duration: 0.3s;
}

#resetSearch:hover {
	opacity: 100%;
	background-color: #b77;
	transition-duration: 0.3s;
}

.options-wrapper-top {
	display: flex;
	align-items: center;
	gap: 10px;
	width: 100%;
}

.options-row-top {
	display: flex;
	flex-wrap: wrap;
	column-gap: 20px;
	row-gap: 10px;
	justify-content: space-around;
	margin: 15px 0 0px;
	border: none;
	align-items: center;
}

.toggle-switch {
	display: flex;
	align-items: center;
	background-color: light-dark(#e0e0e0, #333);
	border-radius: 12px;
	padding: 4px;
	cursor: pointer;
	user-select: none;
	width: 120px;
	position: relative;
	transition: background-color 0.3s;
}

.toggle-switch span {
	flex: 1;
	text-align: center;
	padding: 5px;
	color: light-dark(#888, #888);
	z-index: 1;
	transition: color 0.3s;
}

.toggle-switch span.active {
	color: light-dark(#fff, #fff);
}

.toggle-switch::before {
	content: '';
	position: absolute;
	top: 4px;
	left: 4px;
	width: 56px;
	height: calc(100% - 8px);
	background-color: light-dark(#b77, #b77);
	border-radius: 8px;
	transition: 0.4s cubic-bezier(1, 0, 0, 1);
}

.toggle-switch.active {
	background-color: light-dark(#b77, #b77);
}

.toggle-switch[data-mode="poster"]::before {
	transform: translateX(56px);
}

.sort-order-container {
	display: flex;
	align-items: center;
	gap: 10px;
}

.sort-order-container label {
	font-size: 1em;
	color: light-dark(#000, #fff);
}

.triple-switch {
	display: flex;
	align-items: center;
	background-color: light-dark(#e0e0e0, #333);
	border-radius: 50px;
	padding: 4px;
	cursor: pointer;
	user-select: none;
	width: fit-content;
	position: relative;
	transition: background-color 0.3s;
}

.triple-switch span {
	flex: 1;
	text-align: center;
	padding: 5px 12px;
	border-radius: 30px;
	color: light-dark(#888, #888);
	transition: background-color 0.2s, color 0.2s;
	cursor: pointer;
	z-index: 1;
}

.triple-switch span.active {
	color: light-dark(#fff, #fff);
}

.triple-switch::before {
	content: '';
	position: absolute;
	top: 4px;
	left: 4px;
	width: calc(37%);
	height: calc(100% - 8px);
	background-color: light-dark(#b77, #b77);
	border-radius: 30px;
	transition: 0.4s cubic-bezier(1, 0, 0, 1);
	transition-property: transform, width;
}

.triple-switch[data-sort="alphabetical"]::before {
	transform: translateX(191%);
	width: calc(33%);
}

.triple-switch[data-sort="year"]::before {
	transform: translateX(128%);
	width: calc(28%);
}

.triple-switch[data-sort="random"]::before {
	transform: translateX(0%);
}

.similar-chars-toggle {
	display: flex;
	align-items: center;
	gap: 5px;
}

.similar-chars-toggle label {
	font-size: 1em;
	color: light-dark(#000, #fff);
	cursor: pointer;
	display: flex;
	align-items: center;
	gap: 5px;
}

.similar-chars-toggle input[type="checkbox"] {
	width: 15px;
	height: 15px;
	cursor: pointer;
}

.similar-chars-toggle .tooltip {
	position: relative;
	display: inline-block;
	cursor: pointer;
}

.tooltip {
	position: relative;
	display: inline-block;
}

.tooltip .tooltiptext {
	visibility: hidden;
	width: 150px;
	background-color: #666;
	color: #fff;
	text-align: center;
	border-radius: 6px;
	padding: 5px;
	position: absolute;
	z-index: 1000;
	top: 150%;
	left: 70%;
	margin-left: -53px;
	text-wrap: auto;
	font-size: medium;
	line-height: normal;
}

.tooltip .tooltiptext::after {
	content: "";
	position: absolute;
	bottom: 100%;
	left: 50%;
	opacity: 1;
	margin-left: -32.5px;
	border-width: 5px;
	border-style: solid;
	border-color: transparent transparent #666 transparent;
	transition: opacity 0.5s;
}

.tooltip:hover .tooltiptext {
	visibility: visible;
	opacity: 0.9;
	transition-delay: 0.3s;
}

#toggleSidebarButton {
	background: none;
	border: none;
	cursor: pointer;
	padding: 6px 10px;
}

#toggleSidebarButton:hover {
	background-color: light-dark(#aaa, #333);
}

#desktopSidebarToggleButton {
	position: fixed;
	top: 20px;
	right: 20px;
	z-index: 999;
	background: none;
	color: var(--body-foreground);
	border: none;
	border-radius: 12px;
	padding: 10px 15px;
	cursor: pointer;
	transition: all 0.3s ease-in-out;
}

#desktopSidebarToggleButton:hover {
	background-color: light-dark(#aaa, #333);
}

.options-wrapper-bottom {
	display: flex;
	flex-direction: column;
	width: 100%;
	transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
	overflow: hidden;
	max-height: 200px;
}
.options-wrapper-bottom.collapsed {
	max-height: 0;
	opacity: 0;
}
.rotate-up {
	transform: rotate(360deg) translateY(3px);
}

.rotate-down {
	transform: rotate(180deg) translateY(3px);
}

.sidebar {
	width: 440px;
	overflow-y: auto;
	z-index: 1000;
	resize: none;
	position: fixed;
	top: 20px;
	left: auto;
	right: 20px;
	height: calc(100vh - 40px);
	transition: transform 0.3s ease-in-out;
	background-color: var(--search-background);
	border-radius: 16px;
	box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	transform: translateX(105%);
	z-index: 100;
}

.sidebar.visible-desktop {
	transform: translateX(0);
}


.sidebar-content {
	padding: 0 10px 0 10px;
}

.filtersTitle {
    right: 60px;
    position: relative;
    width: fit-content;
    font-weight: bold;
    height: 15px;
    top: -5px;
}

.mobile-only {
	display: none;
}

.desktop-only {
	display: inline;
}

.sidebar-resize-handle {
	position: absolute;
	top: 0;
	left: 0;
	width: 5px;
	height: 98%;
	cursor: ew-resize;
	background-color: rgba(128, 128, 128, 0.1);
	z-index: 999;
	transition: background-color 0.3s;
}

.sidebar-resize-handle:hover {
	background-color: rgba(128, 128, 128, 0.3);
}

.sidebar-section {
	flex: 1;
	display: flex;
	flex-direction: column;
	min-height: 0;
	transition: flex-grow 0.3s ease-in-out;
	padding-bottom: 8px;
}

.sidebar-section-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	cursor: pointer;
	padding: 0px 20px 0 5px;
	background-color: light-dark(#ddd, #333);
	border-radius: 10px;
	height: 36px;
	transition: 0.4s cubic-bezier(1, 0, 0, 1) border-radius;
}

.sidebar-section.expanded .sidebar-section-header {
	border-radius: 10px 10px 0 0;
}

.sidebar-section-body {
	flex: 1;
	padding-top: 10px;
	padding-bottom: 10px;
	padding-inline: 10px;
	overflow-y: scroll;
	interpolate-size: allow-keywords;
	min-height: 0;
	background-color: var(--svg-background);
	opacity: 1;
	max-height: 350px;
	border-radius: 0 0 10px 10px;
	border: 1px var(--svg-border-color) solid;
	transition: 0.4s cubic-bezier(1, 0, 0, 1);
	transition-property: opacity, max-height, padding-top, padding-bottom;
}

.sidebar-section.collapsed .sidebar-section-body {
	padding-top: 0;
	padding-bottom: 0;
	opacity: 0;
	max-height: 0;
	overflow-y: hidden;
}

.sidebar-section.expanded {
	flex-grow: 1;
}

.collapse-button {
	width: 40px;
	border: none;
	transition: transform 150ms ease-in-out;
	background: none;
	border: none;
	font-size: 18px;
	cursor: pointer;
	color: light-dark(#444, #ccc);
	-webkit-user-select: none;
	user-select: none;
}

.designer-grid,
.director-grid,
.year-grid,
.letter-grid {
	display: flex;
	flex-wrap: wrap;
	gap: 8px;
}

.designer-item,
.director-item,
.year-item,
.letter-item {
	padding: 5px 10px;
	border-radius: 30px;
	cursor: pointer;
	transition: background-color 0.3s;
	white-space: nowrap;
	font-size: smaller;
	border: 1px solid light-dark(#000, #666);
	display: flex;
	gap: 5px;
}

.designer-item:hover,
.director-item:hover,
.year-item:hover,
.letter-item:hover {
	background-color: light-dark(hsl(0 0% 88% / 1), hsl(0 0% 20% / 1));
}

.count {
	color: light-dark(#555, #999);
}

.no-results {
	text-align: center;
	color: light-dark(#777, #999);
	padding: 5px 10px;
	font-size: 0.9em;
}

.filters-container {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
	padding: 10px;
	margin-bottom: 15px;
	background-color: light-dark(#fff, #222);
	border-radius: 16px;
	max-width: 960px;
	width: 100%;
}

.filter-item {
	display: flex;
	align-items: center;
	gap: 5px;
	padding: 5px 10px;
	background-color: light-dark(#eee, #333);
	border-radius: 20px;
	font-size: 0.9em;
	cursor: pointer;
	transition: background-color 0.3s;
}

.filter-item:hover {
	background-color: light-dark(#ddd, #444);
}

.remove-filter {
	background: none;
	border: none;
	color: light-dark(#555, #bbb);
	cursor: pointer;
	padding: 0;
	display: flex;
	align-items: center;
}

.remove-filter:hover {
	color: #b00;
}

.pixelated {
	filter: blur(3px);
	image-rendering: pixelated;
}

.clearSearch {
	position: absolute;
	top: 50%;
	transform: translateY(-50%);
	display: flex;
	inset-inline-end: 12px;
	cursor: pointer;
	color: #888;
	font-size: x-large;
}

.chart-container {
	width: 100%;
	margin-bottom: 20px;
	position: relative;
}

.chart-container svg {
	width: 100%;
	height: 300px;
}

.bar {
	fill: var(--bar-color);
	cursor: pointer;
}

.bar:hover {
	fill: var(--bar-hover-color);
}

.axis path, .axis line {
	stroke: var(--axis-text-color);
}

.axis text {
	fill: var(--axis-text-color);
}

#tooltip {
	position: absolute;
	text-align: center;
	padding: 8px;
	background: rgba(0, 0, 0, 0.7);
	color: white;
	border-radius: 4px;
	pointer-events: none;
	font-size: 14px;
	opacity: 0;
	transition: opacity 0.2s;
}

.show-more-button {
	background-color: var(--bar-color);
	color: white;
	border: none;
	border-radius: 12px;
	padding: 12px 24px;
	font-size: 1em;
	font-weight: bold;
	cursor: pointer;
	transition: background-color 0.3s, transform 0.2s;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.show-more-button:hover {
	background-color: var(--bar-hover-color);
	transform: translateY(-2px);
}

.show-more-button:active {
	transform: translateY(0);
}

.sort-direction-icon {
	transition: transform 0.3s ease-in-out;
}

.sort-direction-icon.asc {
	transform: rotate(0deg);
}

.sort-direction-icon.desc {
	transform: rotate(180deg);
}


@media (max-width: 768px) {
	#app {
		padding: 0;
	}

	#main-content {
		margin-right: 0 !important;
		padding: 15px;
		flex-direction: column;
	}

	.search-bar {
		left: 0 !important;
		width: 100% !important;
		right: auto !important;
		padding: 0px;
	}

	.search-bar-inner {
		padding: 15px;
		border-radius: 16px;
	}
	
	.results-grid {
		width: 100%;
		max-width: 100%;
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 15px;
		padding-left: 15px;
		padding-right: 15px;
	}
	
.item-card {
		width: 100%;
		max-width: none;
	}

	.options {
		gap: 15px;
		align-items: center;
		transition: 0.3s ease-in-out;
		max-height: 200px;
		opacity: 1;
		flex-direction: column;
		justify-content: flex-start;
		align-items: flex-start;
	}

	.options.collapsed {
		max-height: 0;
		opacity: 0;
		margin: 0;
		padding: 0;
		visibility: hidden;
	}

	#showSidebarButton {
		display: inline-block;
	}

	#hideSidebarButton {
		display: inline-block;
		margin-bottom: 10px;
		padding: 8px 14px;
		border: none;
		background: none;
		font-size: x-large;
		cursor: pointer;
	}

	#hideSidebarButton:hover {
	background-color: light-dark(#f0f0f0, #333);
}

	.sidebar {
		position: fixed;
		top: 0;
		right: -105%;
		width: 385px !important;
		height: 100vh;
		background-color: light-dark(#fff, #121212);
		transition: right 0.3s cubic-bezier(1, 0, 0, 1);
		z-index: 1000;
		display: block;
	}

	.sidebar.visible {
		right: 0;
		display: block;
		transform: translateX(0);
	}

	.sidebar-overlay.visible {
		display: block;
	}

	.mobile-only {
		display: inline-block;
	}

	.desktop-only {
		display: none;
	}

	.collapse-button {
		display: inline-block;
		padding: 0;
	}

	.filtersTitle {
    right: 0px;
	}
	.sidebar-resize-handle {
		display: none;
	}
	#desktopSidebarToggleButton {
		display: none;
	}
	.options-toggle-desktop {
		display: none;
	}
	.desktop-options-bar-wrapper {
        display: flex;
        justify-content: center;
        gap: 20px;
        align-items: center;
		margin: 20px 0 5px 0;
        flex-wrap: wrap;
	}
	.controls-wrapper-desktop {
		display: flex;
		flex-wrap: wrap;
		justify-content: space-around;
		row-gap: 10px;
		column-gap: 20px;
		width: auto;
	}
	.search-container {
		gap: 5px;
	}
}

@media (min-width: 769px) {
	.options.collapsed-desktop {
		max-height: 0;
		opacity: 0;
		margin: 0;
		padding: 0;
		visibility: hidden;
		flex-direction: row;
		justify-content: space-around;
	}
	.desktop-options-bar-wrapper {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin: 15px 0 10px 0;
	}
	.controls-wrapper-desktop {
		display: flex;
		align-items: center;
		flex-wrap: wrap;
		width: 63%;
		justify-content: space-around;
		row-gap: 10px;
		column-gap: 20px;
	}
	.counter-wrapper-desktop {
		text-align: center;
		font-weight: bold;
		width: 27%;
	}
	.options {
		transition: 0.3s ease-in-out;
		max-height: 200px;
		opacity: 1;
		flex-direction: row;
		justify-content: space-around;
	}
	.options.collapsed {
		max-height: 0;
		opacity: 0;
		margin: 0;
		padding: 0;
		visibility: hidden;
	}
	.options-toggle-desktop {
		display: inline-block;
		background-color: light-dark(#e0e0e0, #333);
		color: light-dark(#888, #888);
		border: none;
		border-radius: 12px;
		padding: 10px 15px;
		cursor: pointer;
		transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
		white-space: nowrap;
	}
	.options-toggle-desktop.active-options-toggle {
		background-color: light-dark(#b77, #b77);
		color: light-dark(#fff, #fff);
		box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
	}
	.options-toggle-desktop:hover {
		opacity: 0.8;
	}
}
</style>
</head>
<body>
<div id="app">
	<div id="sidebarOverlay" class="sidebar-overlay" :class="{ visible: sidebarVisible && isMobileView }" @click="hideSidebar">
	</div>
	<div id="sidebar" class="sidebar" :class="{ 'visible-desktop': sidebarVisible && !isMobileView }" :style="sidebarStyle">
		<div class="sidebar-resize-handle"></div>
				
		<div class="sidebar-content">
		<div style="display: flex; justify-content: start; gap: 20px; padding-top: 10px;">
			<button @click="hideSidebar" id="hideSidebarButton" class="mobile-only">
				<span class="material-symbols-rounded">
					close
				</span>
			</button>
			<p class="filtersTitle">فیلترها</p>
			</div>

			<div class="sidebar-section" :class="getSectionClass('chart')">
				<div class="sidebar-section-header" @click="toggleCollapse('chart')">
					<span>نمودار تعداد پوسترها</span>
					<button class="collapse-button rotate-up" :class="collapseIconClass(isCollapsed.chart)">
						<span class="material-symbols-rounded">
							keyboard_arrow_up
						</span>
					</button>
				</div>
				<div class="sidebar-section-body">
					<div class="chart-container">
						<svg id="yearsChart"></svg>
						<div id="tooltip"></div>
					</div>
				</div>
			</div>
			
			<div class="sidebar-section" :class="getSectionClass('years')" :key="'years-section'">
				<div class="sidebar-section-header" @click="toggleCollapse('years')">
					<span style="display: none" :style="{ display: undefined }">{{ filteredYearLabel }}</span>
					<span :style="{ display: 'none' }">سال‌ها</span>
					<button class="collapse-button rotate-up" id="yearsButton" :class="collapseIconClass(isCollapsed.years)">
						<span class="material-symbols-rounded">
							keyboard_arrow_up
						</span>
					</button>
				</div>
				<div class="sidebar-section-body">
					<div class="year-grid" style="visibility: hidden" :style="{ visibility: undefined }">
						<div v-if="filteredYearsInModal.length === 0" class="no-results">
							نتیجه‌ای وجود ندارد
						</div>
						<div v-else v-for="[year, count] in filteredYearsInModal" :key="year"
							@click="selectedYear === year ? removeYearFilter() : selectYearFromModal(year)"
							@mouseenter="hoveredItem = year" @mouseleave="hoveredItem = null"
							:class="{ 'hovered': hoveredItem === year }" class="year-item">
							{{ year }} <span class="count">({{ count.toLocaleString('fa') }})</span>
							<span v-if="selectedYear === year" class="remove-filter" @click.stop="removeYearFilter">
								<span class="material-symbols-rounded" style="font-size: inherit;">
									close
								</span>
							</span>
						</div>
					</div>
				</div>
			</div>

			<div class="sidebar-section" :class="getSectionClass('designers')">
				<div class="sidebar-section-header" @click="toggleCollapse('designers')">
					<span style="display: none" :style="{ display: undefined }">{{ filteredDesignerLabel }}</span>
					<span :style="{ display: 'none' }">طراحان</span>
					<button class="collapse-button rotate-up" id="designersButton" :class="collapseIconClass(isCollapsed.designers)">
						<span class="material-symbols-rounded">
							keyboard_arrow_up
						</span>
					</button>
				</div>
				<div class="sidebar-section-body">
					<div class="search-container">
						<input type="text" v-model="designerSearchQuery" placeholder="جستجوی طراح…" />
						<span v-if="designerSearchQuery" @click="clearDesignerSearchQuery" class="clearSearch"
							style="display: none" :style="{ display: undefined }">
							<span class="material-symbols-rounded">
								close
							</span>
						</span>
					</div>
					<div class="designer-grid" style="visibility: hidden" :style="{ visibility: undefined }">
						<div v-if="filteredDesignersInModal.length === 0" class="no-results">
							نتیجه‌ای وجود ندارد
						</div>
						<div v-else v-for="[designer, count] in filteredDesignersInModal" :key="designer"
							@click="selectedDesigner === designer ? removeDesignerFilter() : selectDesignerFromModal(designer)"
							@mouseenter="hoveredItem = designer" @mouseleave="hoveredItem = null"
							:class="{ 'hovered': hoveredItem === designer }" class="designer-item">
							{{ designer }} <span class="count">({{ count.toLocaleString('fa') }})</span>
							<span v-if="selectedDesigner === designer" class="remove-filter"
								@click.stop="removeDesignerFilter">
								<span class="material-symbols-rounded" style="font-size: inherit;">
									close
								</span>
							</span>
						</div>
					</div>
				</div>
			</div>

			<div class="sidebar-section" :class="getSectionClass('directors')">
				<div class="sidebar-section-header" @click="toggleCollapse('directors')">
					<span style="display: none" :style="{ display: undefined }">{{ filteredDirectorLabel }}</span>
					<span :style="{ display: 'none' }">کارگردان‌ها</span>
					<button class="collapse-button rotate-up" id="directorsButton" :class="collapseIconClass(isCollapsed.directors)">
						<span class="material-symbols-rounded">
							keyboard_arrow_up
						</span>
					</button>
				</div>
				<div class="sidebar-section-body">
					<div class="search-container">
						<input type="text" v-model="directorSearchQuery" placeholder="جستجوی کارگردان…" />
						<span v-if="directorSearchQuery" @click="clearDirectorSearchQuery" class="clearSearch"
							style="display: none" :style="{ display: undefined }">
							<span class="material-symbols-rounded">
								close
							</span>
						</span>
					</div>
					<div class="director-grid" style="visibility: hidden" :style="{ visibility: undefined }">
						<div v-if="filteredDirectorsInModal.length === 0" class="no-results">
							نتیجه‌ای وجود ندارد
						</div>
						<div v-else v-for="[director, count] in filteredDirectorsInModal" :key="director"
							@click="selectedDirector === director ? removeDirectorFilter() : selectDirectorFromModal(director)"
							@mouseenter="hoveredItem = director" @mouseleave="hoveredItem = null"
							:class="{ 'hovered': hoveredItem === director }" class="director-item">
							{{ director }} <span class="count">({{ count.toLocaleString('fa') }})</span>
							<span v-if="selectedDirector === director" class="remove-filter"
								@click.stop="removeDirectorFilter">
								<span class="material-symbols-rounded" style="font-size: inherit;">
									close
								</span>
						</div>
					</div>
				</div>
			</div>

			<div class="sidebar-section" :class="getSectionClass('letters')">
				<div class="sidebar-section-header" @click="toggleCollapse('letters')">
					<span style="display: none" :style="{ display: undefined }">{{ filteredLetterLabel }}</span>
					<span :style="{ display: 'none' }">حروف اول</span>
					<button class="collapse-button rotate-up" id="lettersButton" :class="collapseIconClass(isCollapsed.letters)">
						<span class="material-symbols-rounded">
							keyboard_arrow_up
						</span>
					</button>
				</div>
				<div class="sidebar-section-body">
					<div class="letter-grid" style="visibility: hidden" :style="{ visibility: undefined }">
						<div v-if="filteredLettersInModal.length === 0" class="no-results">
							نتیجه‌ای وجود ندارد
						</div>
						<div v-else v-for="[letter, count] in filteredLettersInModal" :key="letter"
							@click="selectedLetter === letter ? removeLetterFilter() : selectLetterFromModal(letter)"
							@mouseenter="hoveredItem = letter" @mouseleave="hoveredItem = null"
							:class="{ 'hovered': hoveredItem === letter }" class="letter-item">
							{{ letter }} <span class="count">({{ count.toLocaleString('fa') }})</span>
							<span v-if="selectedLetter === letter" class="remove-filter"
								@click.stop="removeLetterFilter">
								<span class="material-symbols-rounded" style="font-size: inherit;">
									close
								</span>
						</div>
					</div>
				</div>
			</div>
			<a href="https://t.me/arastehnasab" class="mobile-only"
				style="color: gray; font-weight: normal; text-decoration: none; padding: 10px 20px;">
				پیشنهادی دارید؟
			</a>
		</div>
	</div>
	<!-- دکمه جدید و ثابت برای سایدبار -->
	<button id="desktopSidebarToggleButton" class="desktop-only"
		@click="toggleSidebarDesktop"
		style="display: none;"
		:style="desktopSidebarToggleStyle">
		<span class="material-symbols-rounded">
			{{ sidebarVisible ? 'close' : 'menu' }}
		</span>
	</button>
	
	<div v-if="lightboxItem" style="display: none" :style="{ display: undefined }" class="lightbox" @click="closeLightbox">
		<template v-if="lightboxImage">
			<img :src="lightboxImage" :key="lightboxImage" alt="Lightbox Image" :style="{ backgroundColor: backgroundColor }" />
		</template>
		<template v-else>
			<div class="no-logo-placeholder">
				(بدون لوگو)
			</div>
		</template>
		<div class="lightbox-info desktop-only" v-if="lightboxItem">
			<h2>{{ lightboxItem.filmLabel }}</h2>
			<p>سال تولید: {{ toPersianYear(lightboxItem.date) }}</p>
			<p v-if="lightboxItem.directorLabel && lightboxItem.directorLabel !== 'نامشخص'">کارگردان: {{ lightboxItem.directorLabel }}</p>
			<p v-if="lightboxItem.designerLabel && lightboxItem.designerLabel !== 'نامشخص'">
				طراح پوستر: 
				<span v-for="(designer, index) in lightboxItem.designers" :key="index">
					{{ designer.label }}<span v-if="index < lightboxItem.designers.length - 1">, </span>
				</span>
			</p>
		</div>
		<div class="loading-spinner" v-if="isLoading">
			<svg width="53" height="53" viewBox="0 0 53 53" xmlns="http://www.w3.org/2000/svg">
				<svg:style type="text/css">
@keyframes scale_SQHYY {
	0%, 100% { transform: scale(1); }
	50% { transform: scale(0.7); }
}
@keyframes fade_SQHYY {
	0%, 100% { opacity: 1; }
	50% { opacity: 0.5; }
}
				</svg:style>
				<circle cx="6.5" cy="6.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.57s; transform-origin: 6.5px 6.5px;"></circle>
				<circle cx="6.5" cy="26.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.32s; transform-origin: 6.5px 26.5px;"></circle>
				<circle cx="6.5" cy="46.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.82s; transform-origin: 6.5px 46.5px;"></circle>
				<circle cx="26.5" cy="6.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.04s; transform-origin: 26.5px 6.5px;"></circle>
				<circle cx="26.5" cy="26.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.12s; transform-origin: 26.5px 26.5px;"></circle>
				<circle cx="26.5" cy="46.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -1.2s; transform-origin: 26.5px 46.5px;"></circle>
				<circle cx="46.5" cy="6.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.46s; transform-origin: 46.5px 6.5px;"></circle>
				<circle cx="46.5" cy="26.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.9s; transform-origin: 46.5px 26.5px;"></circle>
				<circle cx="46.5" cy="46.5" r="6.5" fill="#ccc" style="animation: scale_SQHYY 1.2s linear infinite, fade_SQHYY 1.2s linear infinite; animation-delay: -0.73s; transform-origin: 46.5px 46.5px;"></circle>
			</svg>
		</div>
		<button class="lightbox-button" @click.stop="closeLightbox" style="top: 20px; left: 20px">
			<span class="material-symbols-rounded">
				close
			</span>
		</button>
		<a :href="downloadLink(lightboxItem)" aria-label="دریافت پوستر" target="_blank">
			<button class="lightbox-button" style="top: 20px; right: 20px">
				<span class="material-symbols-rounded">
					download
				</span>
			</button>
		</a>
		<button class="lightbox-button desktop-only" style="left: 20px; top: 50%; transform: translateY(-50%);" @click.stop="nextImage">
			<span class="material-symbols-rounded">
				arrow_back_ios
			</span>
		</button>
		<button class="lightbox-button desktop-only" style="right: 20px; top: 50%; transform: translateY(-50%);" @click.stop="prevImage">
			<span class="material-symbols-rounded">
				arrow_forward_ios
			</span>
		</button>

		
	</div>

	<div id="main-content" :style="mainContentStyle">
		<button @click="bringToTop" id="toTop" :style="{ bottom: visibleBringToTop ? '20px' : '-100px' }">
			<span class="material-symbols-rounded">
				north
			</span>
		</button>

		<div id="searchBar" class="search-bar" :class="{ 'visible': isSearchBarVisible }" ref="searchBarRef" :style="searchBarDynamicStyle">
			<div class="search-bar-inner">
				<div class="options-wrapper-container">
					<div class="options-wrapper-top">
						<button @click="toggleSidebar" id="toggleSidebarButton" class="mobile-only">
							<span class="material-symbols-rounded">
								menu
							</span>
						</button>
						<div style="position: relative; width: 100%;">
							<input type="text" v-model="searchTerm" :placeholder="searchPlaceholder" @focus="onSearchFocus" @blur="onSearchBlur" />
							<span v-if="searchTerm" @click="clearSearchTerm" class="clearSearch"
								style="display: none" :style="{ display: undefined }">
								<span class="material-symbols-rounded">
									close
								</span>
							</span>
						</div>
						<button @click="resetFilters" id="resetSearch">
							<span class="material-symbols-rounded">
								refresh
							</span>
						</button>
						<button @click="toggleOptions" class="collapse-button mobile-only"
							:class="collapseIconClass(isOptionsCollapsed)">
							<span class="material-symbols-rounded" style="font-size: xx-large;">
								keyboard_arrow_up
							</span>
						</button>
						<button @click="toggleOptions" class="options-toggle-desktop desktop-only" :class="{ 'active-options-toggle': !isOptionsCollapsed }">جستجوی پیشرفته</button>
					</div>
					<div class="options-wrapper-bottom" :class="{ 'collapsed-desktop': isOptionsCollapsed, 'collapsed': isOptionsCollapsed }">
						<div class="options-row-top">
							<div class="similar-chars-toggle">
								<label for="similarCharsSwitch" style="cursor: pointer;">
									<input type="checkbox" id="similarCharsSwitch" v-model="combineSimilarChars">
									حروف مشابه
								</label>
								<label>
									<span class="material-symbols-rounded tooltip">
										info
										<span class="tooltiptext">حروفی که شکل یکسانی دارند، یکی در نظر گرفته شود: مانند س، ش</span>
									</span>
								</label>
							</div>
							<div class="similar-chars-toggle">
								<label for="exactWordSwitch" style="cursor: pointer;">
									<input type="checkbox" id="exactWordSwitch" v-model="exactWordMatch">
									جستجوی دقیق
								</label>
								<label>
									<span class="material-symbols-rounded tooltip">
										info
										<span class="tooltiptext">فقط نتایجی که دقیقاً با کلمه وارد شده مطابقت دارند</span>
									</span>
								</label>
							</div>
							<div class="similar-chars-toggle" v-if="posterMode">
								<label for="pixelatedSwitch" style="cursor: pointer;">
									<input type="checkbox" id="pixelatedSwitch" v-model="pixelatedEffect">
									سانسور
								</label>
								<label>
									<span class="material-symbols-rounded tooltip">
										info
										<span class="tooltiptext" v-if="posterMode">مخفی کردن تصاویری که ممکن است نامناسب
											باشند</span>
									</span>
								</label>
							</div>
							<div class="similar-chars-toggle">
								<label for="cleanModeSwitch" style="cursor: pointer;">
									<input type="checkbox" id="cleanModeSwitch" v-model="cleanMode">
									مینیمال
								</label>
								<label>
									<span class="material-symbols-rounded tooltip">
										info
										<span class="tooltiptext">فقط تصاویر نمایش داده شوند و باقی اطلاعات مخفی شوند</span>
									</span>
								</label>
								<div v-if="!posterMode && cleanMode" style="margin-right: 10px;">
									<input type="color" v-model="backgroundColor" id="bgColorPicker" style="width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; padding: 0;">
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="desktop-options-bar-wrapper">
					<!-- کانتینر جدید برای گروه‌بندی سوییچ‌ها -->
					<div class="controls-wrapper-desktop">
						<div class="toggle-switch" @click="togglePosterMode"
								id="posterLogoSwitch" data-mode="poster" :data-mode="posterMode ? 'poster' : 'logo'">
								<span id="posterButton" class="active" :class="{ active: posterMode }">پوستر</span>
								<span :class="{ active: !posterMode }">لوگو</span>
						</div>
						<div class="sort-order-container">
							<label @click="toggleSortDirection" style="cursor: pointer;">
								<span class="material-symbols-rounded sort-direction-icon" :class="sortDirection">
									swap_vert
								</span>
							</label>
							<div class="triple-switch" :data-sort="sortOrder">
								<span :class="{ active: sortOrder === 'alphabetical' }"
									@click="sortOrder = 'alphabetical'">الفبایی</span>
								<span :class="{ active: sortOrder === 'year' }" @click="sortOrder = 'year'">سال</span>
								<span id="randomOrderButton" class="active"
									:class="{ active: sortOrder === 'random' }" @click="sortOrder = 'random'">تصادفی</span>
							</div>
						</div>
					</div>
					<!-- شمارنده نتایج با عرض ثابت -->
					<div v-if="filteredItems.length > 0"
						class="counter-wrapper-desktop"
						>
						<span v-if="hasActiveFilters">{{ filteredItemsLength }} از {{ itemsLength }} {{ posterMode ? 'پوستر' : 'لوگو' }} ({{ uniqueResultsFilmCount }} از {{ uniqueFilmCount }} فیلم)</span>
						<span v-else>{{ itemsLength }} {{ posterMode ? 'پوستر' : 'لوگو' }} ({{ uniqueFilmCount }} فیلم)</span>
					</div>
				</div>
			</div>
		</div>
		<div id="filters" class="filters-container" v-if="activeFilters.length > 0" style="display: none" :style="{ display: undefined }">
			<div v-for="(filter, index) in activeFilters" :key="index" @click="removeFilter(filter.type, filter.value)"
				class="designer-item">
				<span style="align-content: center;">{{ filter.label }}: {{ filter.value }}</span>
				<button class="remove-filter">
					<span class="material-symbols-rounded">close</span>
				</button>
			</div>
		</div>
		<div v-if="filteredItems.length > 0" class="results-grid">
			<div class="item-card" v-for="(item, index) in filteredItems.slice(0, displayedItemsCount)" :key="index" :class="{ 'minimal': cleanMode }" style="visibility: hidden" :style="{ visibility: undefined, padding: !posterMode && cleanMode ? '0' : '15px 5px', background: !posterMode && cleanMode ? backgroundColor : 'var(--card-background)', border: !posterMode && cleanMode ? 'none' : '1px solid ' + 'var(--card-background)' }">
				<div style="display: flex; flex-direction: column; justify-content: center; height: 100%;">
					<div class="image-container" :style="{ aspectRatio: !posterMode && cleanMode ? '1/1' : '5/7.5' }">
						<a @click="handleImageClick(item)" :href="getCommonsUrl(item, posterMode, pixelatedEffect)"
							class="clickable-image">
								<img :src="getItemUrl(item, posterMode, pixelatedEffect)"
									:key="getItemUrl(item, posterMode, pixelatedEffect)" :alt="item.filmLabel"
									class="item-image"
									:class="{ 'no-logo-bw': !item.logo && !posterMode }" :style="{ borderRadius: !posterMode && cleanMode ? '8px' : '0', marginBottom: !posterMode && cleanMode ? '0' : '10px', aspectRatio: !posterMode && cleanMode ? '1/1' : '5/7.5' }" />
						</a>
						<a :href="downloadLink(item)" aria-label="دریافت پوستر" target="_blank">
							<button class="download-btn">
								<span class="material-symbols-rounded">
									download
								</span>
							</button>
						</a>
					</div>
	
					<div class="item-title" :class="{ 'minimal': cleanMode }">
						{{ item.filmLabel }}
						<span class="year-link" v-if="item.date">
							({{ toPersianYear(item.date) }})
						</span>
					</div>
	
					<div v-if="!cleanMode" class="item-designer">
						<span class="mobile-only">
							<span class="material-symbols-rounded"
								style="margin-left: 5px; top: 8px; position: relative;">person_edit</span>
						</span>
						<span class="desktop-only">{{ item.designers.length === 1 ? 'طراح: ' : 'طراحان: ' }}</span>
						<span v-for="(designer, index) in item.designers" :key="index">
							<a href="#" @click.prevent="selectDesigner(designer.label)" aria-label="انتخاب طراح">{{ designer.label }}</a>
							<span class="item-links">
								<a :href="'https://www.wikidata.org/wiki/' + designer.id" aria-label="ویکی‌داده" target="_blank">
									<img src="https://upload.wikimedia.org/wikipedia/commons/7/71/Wikidata.svg"
										alt="ویکی‌داده" class="linkIcon">
								</a>
								<template v-if="designer.faWikipediaLink">
									<a :href="'https://fa.wikipedia.org/wiki/' + designer.faWikipediaLink.replaceAll(' ', '_')"
										aria-label="ویکی‌پدیا" target="_blank">
										<img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Wikipedia_%22W%22_Rounded_White.svg"
											alt="ویکی‌پدیا" class="linkIcon">
									</a>
								</template>
							</span>
							<br v-if="index < item.designers.length - 1">
						</span>
					</div>
				</div>
				<div id="film-links" class="item-links" v-if="!cleanMode">
					<a v-if="item.imdbID" :href="'https://www.imdb.com/title/' + item.imdbID" aria-label="IMDb" target="_blank">
						<img src="https://upload.wikimedia.org/wikipedia/commons/5/53/IMDB_-_SuperTinyIcons.svg"
							alt="IMDb" class="linkIcon">
					</a>
					<a v-if="item.film" :href="'https://www.wikidata.org/wiki/' + item.film" aria-label="ویکی‌داده" target="_blank">
						<img src="https://upload.wikimedia.org/wikipedia/commons/7/71/Wikidata.svg" alt="ویکی‌داده" class="linkIcon">
					</a>
					<a v-if="item.faWikipediaLink"
						:href="'https://fa.wikipedia.org/wiki/' + item.faWikipediaLink.replaceAll(' ', '_')"
						aria-label="ویکی‌پدیا" target="_blank">
						<img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Wikipedia_%22W%22_Rounded_White.svg"
							alt="ویکی‌پدیا" class="linkIcon">
					</a>
				</div>
			</div>
		</div>
		<p v-else style="text-align: center; display: none;" :style="{ display: undefined }">
			نتیجه‌ای برای نمایش وجود ندارد.
		</p>
		<div v-if="displayedItemsCount < filteredItems.length" style="text-align: center; padding-top: 1em;">
			<button @click="showMore" class="show-more-button" style="display: none" :style="{ display: undefined }">
				نمایش بیشتر ({{ Math.min(filteredItems.length - displayedItemsCount, 30).toLocaleString('fa') }})
			</button>
		</div>
	</div>
</div>
<script>
{
	const urlParams = new URLSearchParams(window.location.search);
	similarCharsSwitch.checked = urlParams.get('similar') === 'true';
	pixelatedSwitch.checked = urlParams.get('censor') === null
		? location.hostname.endsWith('.ir')
		: urlParams.get('censor') === 'true';
}
</script>
<link rel="modulepreload" href="./vue.esm-browser.prod.min.js" />
<link rel="preload" as="fetch" href="./db.json">
<script type="module">
import {
	createApp, ref, computed, watch, onMounted, nextTick, onUnmounted
} from './vue.esm-browser.prod.min.js';
const data = await (await fetch('./db.json', {
	method: 'GET',
	credentials: 'include',
	mode: 'no-cors',
})).json();
randomOrderButton.classList.remove('active');
posterButton.classList.remove('active');
posterLogoSwitch.removeAttribute('data-mode');
[yearsButton, designersButton, directorsButton, lettersButton]
	.forEach(x => x.classList.remove('rotate-up'));
desktopSidebarToggleButton.style.display = 'block';

createApp({ setup: () => {

const darkMode = ref(false);
const toggleDarkMode = () => darkMode.value = !darkMode.value;
const isShowMore = ref(false);
const designerQuery = ref('');
const isOptionsCollapsed = ref(true);
const designerSearchQuery = ref('');
const searchTerm = ref('');
const selectedYear = ref('');
const selectedDesigner = ref('');
const selectedDirector = ref('');
const selectedLetter = ref('');
const posterMode = ref(true);
const combineSimilarChars = ref(false);
const pixelatedEffect = ref(false);
const cleanMode = ref(false);
const sortOrder = ref('random');
const sortDirection = ref('asc');
const searchPlaceholder = ref(''); // مقدار اولیه خالی
const isSearchFocused = ref(false);
const displayedItemsCount = ref(30);
const exactWordMatch = ref(false);
const isSearchBarVisible = ref(true);
const searchBarRef = ref(null);
const searchBarHeight = ref(0);
const isMobileView = ref(false);
const isDesktopSidebarFixed = ref(false);
const yearsChartInstance = ref(null);
const isD3Loaded = ref(false);
const backgroundColor = ref('#ffffff');
const savedMinimalColor = ref('#ffffff');

const showMore = () => {
	displayedItemsCount.value += 30;
};

const onSearchFocus = () => {
	isSearchFocused.value = true;
};

const onSearchBlur = () => {
	isSearchFocused.value = false;
};

const hasActiveFilters = computed(() => {
	return searchTerm.value || 
		selectedYear.value || 
		selectedDesigner.value || 
		selectedDirector.value || 
		selectedLetter.value;
});

const applyInitialFilters = () => {
	const urlParams = new URLSearchParams(window.location.search);
	searchTerm.value = urlParams.get('q') || '';
	selectedYear.value = urlParams.get('y') || '';
	selectedDesigner.value = urlParams.get('designer') || '';
	selectedDirector.value = urlParams.get('director') || '';
	selectedLetter.value = urlParams.get('letter') || '';
	posterMode.value = urlParams.get('mode') !== 'logo';
	combineSimilarChars.value = urlParams.get('similar') === 'true';
	pixelatedEffect.value = urlParams.get('censor') === null
		? location.hostname.endsWith('.ir')
		: urlParams.get('censor') === 'true';
	sortOrder.value = urlParams.get('sort') || 'random';
	sortDirection.value = urlParams.get('dir') || 'asc';
	exactWordMatch.value = urlParams.get('exact') === 'true';
	cleanMode.value = urlParams.get('clean') === 'true';
	backgroundColor.value = urlParams.get('bgcolor') || '#ffffff';
	savedMinimalColor.value = backgroundColor.value;
};
applyInitialFilters();

const updateURL = () => {
	const params = new URLSearchParams();
	if (searchTerm.value) params.set('q', searchTerm.value);
	if (selectedYear.value) params.set('y', selectedYear.value);
	if (selectedDesigner.value) params.set('designer', selectedDesigner.value);
	if (selectedDirector.value) params.set('director', selectedDirector.value);
	if (selectedLetter.value) params.set('letter', selectedLetter.value);
	params.set('mode', posterMode.value ? 'poster' : 'logo');
	params.set('similar', combineSimilarChars.value ? 'true' : 'false');
	params.set('censor', pixelatedEffect.value ? 'true' : 'false');
	params.set('sort', sortOrder.value);
	if (sortOrder.value !== 'random') {
		params.set('dir', sortDirection.value);
	}
	params.set('exact', exactWordMatch.value ? 'true' : 'false');
	if (cleanMode.value) params.set('clean', 'true');
	if (!posterMode.value) {
		params.set('bgcolor', backgroundColor.value);
	}

	const newUrl = `${window.location.pathname}?${params.toString()}`;
	window.history.pushState({}, '', newUrl);
};
watch([
	searchTerm, selectedYear, selectedDesigner, selectedDirector,
	selectedLetter, posterMode, combineSimilarChars, pixelatedEffect, sortOrder, sortDirection, exactWordMatch,
	cleanMode, backgroundColor
], updateURL);

const isCollapsed = ref({
	designers: false,
	directors: true,
	years: false,
	letters: true,
	chart: true
});

const getSectionClass = section => isCollapsed.value[section] ? 'collapsed' : 'expanded';
const selectDirectorFromModal = director => selectedDirector.value = director;
const selectYearFromModal = year => selectedYear.value = year;
const selectLetterFromModal = letter => selectedLetter.value = letter;
const togglePosterMode = () => posterMode.value = !posterMode.value;
const toggleOptions = () => isOptionsCollapsed.value = !isOptionsCollapsed.value;
const collapseIconClass = value => value ? 'rotate-down' : 'rotate-up';
const toggleSortDirection = () => sortDirection.value = sortDirection.value === 'asc' ? 'desc' : 'asc';

const selectDesigner = designer => {
	selectedDesigner.value = designer;
	designerQuery.value = designer;
	applyFilters();
};

const applyFilters = () => {};

const resetFilters = () => {
	searchTerm.value = '';
	combineSimilarChars.value = false;
	sortOrder.value = 'random';
	selectedYear.value = '';
	selectedDesigner.value = '';
	selectedDirector.value = '';
	selectedLetter.value = '';
	sortDirection.value = 'asc';
	exactWordMatch.value = false;
	cleanMode.value = false;
	backgroundColor.value = '#ffffff';
};

const films = Object.values(data.films);
const posters = films.flatMap(film => film.posters);
const logos = films.flatMap(film => film.logos).filter(logo => logo.image.endsWith('.png'));

const uniqueFilmCount = computed(() => films.length.toLocaleString('fa', { useGrouping: false }));

const uniqueResultsFilmCount = computed(() => {
	const uniqueFilmIds = new Set(filteredItems.value.map(item => item.film));
	return uniqueFilmIds.size.toLocaleString('fa', { useGrouping: false });
});

const items = films.flatMap(film => {
	return film.posters.map((poster, i) => {
		const item = {};
		item.film = film.id;
		if (!film.labels.fa) {
			console.log(film.id + ' doesn\'t have Persian label!');
		}
		item.filmLabel = film.labels.fa || film.labels.en || '';
		item.aliases = film.aliases?.fa?.join(',') ?? '';
		item.date = film.date
			.map(x => x.replace(/^\+/, '')
				.replace('-01-01T00:00:00Z', '-03-30T00:00:00Z')
				.replace('-00-00T00:00:00Z', '-03-30T00:00:00Z')
				.replace('-00T', '-01T')
			)
			.sort((a, b) => new Date(a).getTime() - new Date(b).getTime())[0];
		item.poster = poster.image;
		item.posterHash = poster.hash;
		item.isNsfw = poster.characteristics?.includes('Q2716583') ?? false;
		if (poster.designers?.length ?? 0) {
			item.designers = poster.designers.map(designerId => {
				const designer = data.secondary[designerId];
				return {
					id: designerId,
					label: designer.labels.fa,
					faWikipediaLink: designer.sitelinks?.fawiki
				};
			});
			item.characteristics = poster.characteristics;
			item.designerLabel = data.secondary[poster.designers[0]].labels.fa;
			const fawiki = data.secondary[poster.designers[0]].sitelinks.fawiki;
			if (fawiki) item.designerFaWikipediaLink = fawiki;
		} else {
			item.designerLabel = 'نامشخص';
		}
		if (film.directors.length) {
			item.director = film.directors[0];
			item.directorLabel = data.secondary[film.directors[0]].labels.fa;
		} else {
			item.directorLabel = 'نامشخص';
		}
		if (film.imdb.length) {
			item.imdbID = film.imdb[0];
		}
		item.faWikipediaLink = film.sitelinks.fawiki;
		if (film.logos.length > i && film.logos[i].image.endsWith('.png')) {
			item.logo = film.logos[i].image;
			item.logoHash = film.logos[i].hash;
		}
		return item;
	});
});
const itemsLength = computed(() => {
	const count = posterMode.value
		? posters.length
		: logos.length;
	return count.toLocaleString('fa', { useGrouping: false });
});

const similarCharsMapping = {
	'آ': '[آاأإ]', 'ا': '[آاأإ]', 'أ': '[آاأإ]', 'إ': '[آاأإ]', 'ط': '[طظ]', 'ظ': '[طظ]', 'ب': '[بپتثنی]', 'پ': '[بپتثنی]',
	'ت': '[بپتثنی]', 'ث': '[بپتثنی]', 'ن': '[بپتثنی]', 'ی': '[بپتثنی]', 'ج': '[جچحخ]',
	'چ': '[جچحخ]', 'ح': '[جچحخ]', 'خ': '[جچحخ]', 'د': '[دذ]',
	'ذ': '[دذ]', 'ر': '[رزژ]', 'ز': '[رزژ]', 'ژ': '[رزژ]', 'س': '[سش]',
	'ش': '[سش]', 'ص': '[صض]', 'ض': '[صض]', 'ع': '[عغ]',
	'غ': '[عغ]', 'ف': '[فق]', 'ق': '[فق]', 'ک': '[کگ]',
	'گ': '[کگ]'
};

const persianAlphabet = [
	'آ', 'ا', 'ب', 'پ', 'ت', 'ث', 'ج', 'چ', 'ح', 'خ', 'د', 'ذ', 'ر', 'ز', 'ژ', 'س', 'ش', 'ص', 'ض', 'ط', 'ظ', 'ع', 'غ', 'ف', 'ق', 'ک', 'گ', 'ل', 'م', 'ن', 'و', 'ه', 'ی'
];

const toPersianYear = date => {
	const year = new Date(date).toLocaleDateString('fa').split('/')[0];
	return year === 'Invalid Date' ? 'نامشخص' : year;
};

const availableYears = computed(() => {
	const groups = Object.groupBy(items, item => toPersianYear(item.date));
	let years = Object.keys(groups)
		.map(year => [year, groups[year].length]);
	
	const unknown = years.find(([name]) => name === 'نامشخص');
	years = years.filter(([name]) => name !== 'نامشخص').sort();
	if (unknown) {
		years.push(unknown);
	}
	return years;
});

const availableDesigners = computed(() => {
	const groups = Object.groupBy(items, item => item.designerLabel);
	let designers = Object.keys(groups)
		.map(designer => [designer, groups[designer].length]);

	const unknown = designers.find(([name]) => name === 'نامشخص');
	designers = designers.filter(([name]) => name !== 'نامشخص').sort((a, b) => b[1] - a[1]);
	if (unknown) {
		designers.push(unknown);
	}
	return designers;
});

const availableDirectors = computed(() => {
	const groups = Object.groupBy(items, item => item.directorLabel);
	let directors = Object.keys(groups)
		.map(director => [director, groups[director].length]);

	const unknown = directors.find(([name]) => name === 'نامشخص');
	directors = directors.filter(([name]) => name !== 'نامشخص').sort((a, b) => b[1] - a[1]);
	if (unknown) {
		directors.push(unknown);
	}
	return directors;
});

const getItemTitleWithYear = item => {
	return item.filmLabel + (item.date ? ` (${toPersianYear(item.date)})` : '');
};

const letterCounts = computed(() => {
	const counts = persianAlphabet.reduce((acc, letter) => {
		acc[letter] = items.filter(item => item.filmLabel.startsWith(letter)).length;
		return acc;
	}, {});
	return counts;
});

const filteredItems = computed(() => {
	let results = items;

	const trimmedSearchTerm = searchTerm.value
		.replace(/^[\s\u200C]+|[\s\u200C]+$/g, '')
		.trim();

	if (trimmedSearchTerm.length) {
		let regexString;
		if (exactWordMatch.value) {
			 let modifiedSearchTerm = trimmedSearchTerm
				.split(/\s+/)
				.filter(Boolean)
				.map(part => {
					return part.split('').map(char => combineSimilarChars.value ? (similarCharsMapping[char] || char) : char).join('');
				})
				.join('|'); // OR operator
			regexString = `(^|\\s)(${modifiedSearchTerm})(?=\\s|$)`;
		} else {
			 let regexParts = trimmedSearchTerm.split(/\s+/).filter(Boolean);
			if (combineSimilarChars.value) {
				regexParts = regexParts.map(part => {
					return part.split('').map(char => similarCharsMapping[char] || char).join('');
				});
			}
			regexString = regexParts.map(part => `(?=.*${part})`).join('');
		}
		
		try {
			const regex = new RegExp(regexString, 'iu');
			results = results.filter(item =>
				regex.test(item.filmLabel) ||
				regex.test(item.aliases || '')
			);
		} catch (e) {
			console.error("Error in regex:", e);
		}
	}


	if (selectedYear.value) {
		results = results.filter(item => toPersianYear(item.date) === selectedYear.value);
	}

	if (selectedDesigner.value) {
		results = results.filter(item =>
			item.designerLabel === selectedDesigner.value
		);
	}

	if (selectedDirector.value) {
		results = results.filter(item => item.directorLabel === selectedDirector.value);
	}

	if (selectedLetter.value) {
		results = results.filter(item => item.filmLabel.startsWith(selectedLetter.value));
	}

	if (!posterMode.value) {
		results = results.filter(item => item.logo);
	}


	if (sortOrder.value === 'alphabetical') {
		results = results.sort((a, b) => {
			const comparison = a.filmLabel.localeCompare(b.filmLabel, 'fa');
			return sortDirection.value === 'asc' ? comparison : -comparison;
		});
	} else if (sortOrder.value === 'year') {
		results = results.sort((a, b) => {
			const dateA = a.date ? new Date(a.date).getTime() : 0;
			const dateB = b.date ? new Date(b.date).getTime() : 0;
			const comparison = dateA - dateB;
			return sortDirection.value === 'asc' ? comparison : -comparison;
		});
	} else if (sortOrder.value === 'random') {
		results = results.slice().sort(() => Math.random() - 0.5);
	}

	return results;
});

watch(designerQuery, newValue => {
	if (!newValue) {
		selectedDesigner.value = '';
	}
});

const filteredYears = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => toPersianYear(item.date));
	let years = Object.keys(groups)
		.map(year => [year, groups[year].length]);
	
	const unknown = years.find(([name]) => name === 'نامشخص');
	years = years.filter(([name]) => name !== 'نامشخص').sort();
	if (unknown) {
		years.push(unknown);
	}
	return years;
});

const filteredDesigners = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => item.designerLabel);
	let designers = Object.keys(groups)
		.map(designer => [designer, groups[designer].length]);

	const unknown = designers.find(([name]) => name === 'نامشخص');
	designers = designers.filter(([name]) => name !== 'نامشخص').sort((a, b) => b[1] - a[1]);
	if (unknown) {
		designers.push(unknown);
	}
	return designers;
});

const filteredDirectors = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => item.directorLabel);
	let directors = Object.keys(groups)
		.map(director => [director, groups[director].length]);

	const unknown = directors.find(([name]) => name === 'نامشخص');
	directors = directors.filter(([name]) => name !== 'نامشخص').sort((a, b) => b[1] - a[1]);
	if (unknown) {
		directors.push(unknown);
	}
	return directors;
});

const filteredDesignersInModal = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => item.designerLabel);
	let designers = Object.keys(groups)
		.map(designer => [designer, groups[designer].length]);

	const unknown = designers.find(([name]) => name === 'نامشخص');
	designers = designers.filter(([name]) => name !== 'نامشخص').sort((a, b) => b[1] - a[1]);
	if (unknown) {
		designers.push(unknown);
	}
	if (!designerSearchQuery.value) {
		return designers;
	}
	return designers.filter(([designer]) =>
		designer.includes(designerSearchQuery.value)
	);
});

const selectDesignerFromModal = designer => {
	selectedDesigner.value = designer;
	designerQuery.value = designer;
};

// تغییر برای بازگرداندن مقادیر عددی
const filteredYearsInModal = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => toPersianYear(item.date));
	let years = Object.keys(groups)
		.map(year => [year, groups[year].length]);

	const unknown = years.find(([name]) => name === 'نامشخص');
	years = years.filter(([name]) => name !== 'نامشخص').sort();
	if (unknown) {
		years.push(unknown);
	}
	return years;
});

watch(filteredItems, (newValue) => {
	displayedItemsCount.value = 30;
	if (newValue.length > 100) {
		isShowMore.value = false;
	}
});

const directorSearchQuery = ref('');

const filteredDirectorsInModal = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => item.directorLabel);
	let directors = Object.keys(groups)
		.map(director => [director, groups[director].length]);

	const unknown = directors.find(([name]) => name === 'نامشخص');
	directors = directors.filter(([name]) => name !== 'نامشخص').sort((a, b) => b[1] - a[1]);
	if (unknown) {
		directors.push(unknown);
	}

	if (!directorSearchQuery.value) {
		return directors;
	}
	return directors.filter(([director]) =>
		director.includes(directorSearchQuery.value)
	);
});

const filteredLettersInModal = computed(() => {
	const groups = Object.groupBy(filteredItems.value, item => item.filmLabel[0]);

	const letters = persianAlphabet
		.filter(letter => groups[letter])
		.map(letter => [letter, groups[letter].length]);

	return letters;
});

const filteredYearLabel = computed(() => selectedYear.value ? `سال: ${selectedYear.value}` : 'سال‌ها');
const filteredDesignerLabel = computed(() => selectedDesigner.value ? `طراح: ${selectedDesigner.value}` : 'طراحان');
const filteredDirectorLabel = computed(() => selectedDirector.value ? `کارگردان: ${selectedDirector.value}` : 'کارگردان‌ها');
const filteredLetterLabel = computed(() => selectedLetter.value ? `حرف اول: ${selectedLetter.value}` : 'حروف اول');

const sidebarWidth = ref(440);
const minSidebarWidth = ref(300);
const maxSidebarWidth = ref(600);

let startX, startWidth;
const startResize = e => {
	e.preventDefault();
	startX = e.clientX;
	startWidth = sidebarWidth.value;
	document.addEventListener('mousemove', resize);
	document.addEventListener('mouseup', stopResize);
};

const resize = e => {
	const newWidth = startWidth + (startX - e.clientX);
	if (newWidth >= minSidebarWidth.value && newWidth <= maxSidebarWidth.value) {
		sidebarWidth.value = newWidth;
	}
};

const stopResize = () => {
	document.removeEventListener('mousemove', resize);
	document.removeEventListener('mouseup', stopResize);
};

onMounted(() => {
	const resizeHandle = document.querySelector('.sidebar-resize-handle');
	if (resizeHandle) {
		resizeHandle.addEventListener('mousedown', startResize);
	} else {
		console.log('عنصر دستگیره تغییر اندازه یافت نشد!');
	}
});

const hoveredItem = ref(null);

const removeYearFilter = () => {
	selectedYear.value = '';
	hoveredItem.value = null;
};

const removeDesignerFilter = () => {
	selectedDesigner.value = '';
	hoveredItem.value = null;
};

const removeDirectorFilter = () => {
	selectedDirector.value = '';
	hoveredItem.value = null;
};

const removeLetterFilter = () => {
	selectedLetter.value = '';
	hoveredItem.value = null;
};

const sidebarVisible = ref(false);

const toggleSidebar = () => {
	sidebarVisible.value = !sidebarVisible.value;
	if (sidebarVisible.value) {
		window.history.pushState(null, '', window.location.pathname);
	}
};

const hideSidebar = () => {
	sidebarVisible.value = false;
};

const toggleSidebarDesktop = () => {
	sidebarVisible.value = !sidebarVisible.value;
};

const handleDesktopSidebarHoverEnter = () => {};

const handleDesktopSidebarHoverLeave = () => {};


onMounted(() => window.addEventListener('popstate', handlePopState));

onUnmounted(() => window.removeEventListener('popstate', handlePopState));

const handlePopState = e => {
	if (sidebarVisible.value) {
		hideSidebar();
		e.preventDefault();
		window.history.pushState(null, '', window.location.pathname);
	}
};

const clearSearchTerm = () => searchTerm.value = '';
const clearDesignerSearchQuery = () => designerSearchQuery.value = '';
const clearDirectorSearchQuery = () => directorSearchQuery.value = '';

const toggleCollapse = section => isCollapsed.value[section] = !isCollapsed.value[section];

const lightboxItem = ref(undefined);
const lightboxImage = ref(undefined);
const isLoading = ref(false);

const openLightbox = item => {
	if (!posterMode.value && !item.logo) {
		lightboxImage.value = undefined;
		lightboxItem.value = undefined;
		return;
	}
	isLoading.value = true;
	lightboxImage.value = posterMode.value ? getPosterUrl(item.poster, item.posterHash, 960) : getPosterUrl(item.logo, item.logoHash, 960);
	lightboxItem.value = item;

	const currentIndex = filteredItems.value.findIndex(i => i === item);
	preloadImages(currentIndex);

	setTimeout(() => {
		isLoading.value = false;
	}, 1000);
};

const closeLightbox = () => {
	lightboxItem.value = undefined;
	isLoading.value = false;
};

watch(lightboxItem, newValue => {
	if (newValue) {
		document.addEventListener('click', handleClickOutsideLightbox);
	} else {
		document.removeEventListener('click', handleClickOutsideLightbox);
	}
});

const handleClickOutsideLightbox = event => {
	const lightbox = document.querySelector('.lightbox');
	if (lightbox && !lightbox.contains(event.target)) {
		closeLightbox();
	}
};

const handleImageClick = item => {
	if ((event.button !== 0 && event.which !== 1) ||
		event.altKey || event.ctrlKey || event.shiftKey || event.metaKey) {
		return true;
	}

	console.log('Image clicked:', item);
	event.preventDefault();
	event.stopPropagation();
	openLightbox(item);
};

const changeLightboxImage = changeIndexCallback => {
	isLoading.value = true;
	const newIndex = changeIndexCallback(
		filteredItems.value.findIndex(item => item.poster === lightboxItem.value.poster),
		filteredItems.value.length - 1
	);
	lightboxItem.value = filteredItems.value[newIndex];
	lightboxImage.value = posterMode.value 
		? getPosterUrl(lightboxItem.value.poster, lightboxItem.value.posterHash, 960) 
		: getPosterUrl(lightboxItem.value.logo, lightboxItem.value.logoHash, 960);
	
	preloadImages(newIndex);
	
	setTimeout(() => isLoading.value = false, 1000);
};
const prevImage = () => changeLightboxImage((current, lastItem) => current <= 0 ? lastItem : current - 1);
const nextImage = () => changeLightboxImage((current, lastItem) => current >= lastItem ? 0 : current + 1);

onMounted(() => {
	window.addEventListener('keydown', handleKeyDown);
});

onUnmounted(() => {
	window.removeEventListener('keydown', handleKeyDown);
});

const handleKeyDown = (event) => {
	if (lightboxItem.value) {
		if (event.key === 'ArrowLeft') {
			nextImage();
		} else if (event.key === 'ArrowRight') {
			prevImage();
		}
	}
};

const preloadedImages = ref({});
const preloadNext = ref(null);
const preloadPrev = ref(null);

const preloadImages = (currentIndex) => {
	const nextIndex = currentIndex + 1 < filteredItems.value.length ? currentIndex + 1 : 0;
	const prevIndex = currentIndex - 1 >= 0 ? currentIndex - 1 : filteredItems.value.length - 1;
	
	const nextItem = filteredItems.value[nextIndex];
	const prevItem = filteredItems.value[prevIndex];
	
	if (nextItem) {
		preloadNext.value = new Image();
		preloadNext.value.src = posterMode.value ? getPosterUrl(nextItem.poster, nextItem.posterHash, 960) : getPosterUrl(nextItem.logo, nextItem.logoHash, 960);
	}
	
	if (prevItem) {
		preloadPrev.value = new Image();
		preloadPrev.value.src = posterMode.value ? getPosterUrl(prevItem.poster, prevItem.posterHash, 960) : getPosterUrl(prevItem.logo, prevItem.logoHash, 960);
	}
};

const downloadLink = item => {
	const name = posterMode.value ? item.poster : item.logo;
	if (!name) return 'https://upload.wikimedia.org/wikipedia/commons/8/82/NoImageEn.svg';
	const hash = posterMode.value ? item.posterHash : item.logoHash;
	return `https://upload.wikimedia.org/wikipedia/commons/${hash[0]}/${hash}/${name}?download`;
};

const selectYearFromTitle = year => selectedYear.value = year;

const activeFilters = computed(() => {
	const filters = [];
	if (selectedYear.value) {
		filters.push({ type: 'year', label: 'سال', value: selectedYear.value });
	}
	if (selectedDesigner.value) {
		filters.push({ type: 'designer', label: 'طراح', value: selectedDesigner.value });
	}
	if (selectedDirector.value) {
		filters.push({ type: 'director', label: 'کارگردان', value: selectedDirector.value });
	}
	if (selectedLetter.value) {
		filters.push({ type: 'letter', label: 'حرف اول', value: selectedLetter.value });
	}
	return filters;
});

const removeFilter = (type, value) => {
	switch (type) {
		case 'year':
			selectedYear.value = '';
			break;
		case 'designer':
			selectedDesigner.value = '';
			break;
		case 'director':
			selectedDirector.value = '';
			break;
		case 'letter':
			selectedLetter.value = '';
			break;
	}
};

const filteredItemsLength = computed(() => {
	return filteredItems.value.length.toLocaleString('fa', { useGrouping: false });
});

const getPosterUrl = (name, hash, width) => {
	if (!name) return 'https://upload.wikimedia.org/wikipedia/commons/8/82/NoImageEn.svg';
	return `https://upload.wikimedia.org/wikipedia/commons/thumb/${hash[0]}/${hash}/${name}/${width}px-${name}`;
};

const getItemUrl = (item, posterMode, pixelatedEffect) => {
	if (posterMode && pixelatedEffect && item.isNsfw && item.logo) {
		return getPosterUrl(item.logo, item.logoHash, 250);
	}
	if (posterMode) {
		return getPosterUrl(item.poster, item.posterHash, 250);
	}
	if (!posterMode) {
		if (item.logo) {
			return getPosterUrl(item.logo, item.logoHash, 250);
		}
		return getPosterUrl(item.poster, item.posterHash, 250);
	}
};

const getCommonsUrl = (item, posterMode, pixelatedEffect) => {
	if (!posterMode && !item.logo) return '#';
	return 'https://commons.wikimedia.org/wiki/File:' + (posterMode ? item.poster : item.logo);
};

const bringToTop = () => document.documentElement.scrollTop = 0;
const visibleBringToTop = ref(false);

const mainContentPaddingTop = computed(() => {
	const basePadding = 0; 
	if (isMobileView.value) {
		return `${searchBarHeight.value + basePadding + 30}px`;
	} else {
		return isSearchBarVisible.value ? `${searchBarHeight.value + basePadding}px` : `${basePadding}px`;
	}
});


let lastScrollPosition = 0;
const scrollTolerance = 50;

const handleScroll = () => {
	const currentScrollY = window.scrollY;
	const docHeight = document.body.scrollHeight;
	const viewportHeight = window.innerHeight;

	if (docHeight < viewportHeight * 1.5) {
		isSearchBarVisible.value = true;
		lastScrollPosition = currentScrollY;
		return;
	}

	if (currentScrollY > lastScrollPosition + scrollTolerance) {
        // Scrolling down past tolerance
        isSearchBarVisible.value = false;
        lastScrollPosition = currentScrollY;
    } else if (currentScrollY < lastScrollPosition - scrollTolerance) {
        // Scrolling up past tolerance
        isSearchBarVisible.value = true;
        lastScrollPosition = currentScrollY;
    }
	
	// Always show search bar at the very top and bottom of the page
	if (currentScrollY <= 0 || (window.innerHeight + window.scrollY) >= docHeight) {
		isSearchBarVisible.value = true;
	}

	visibleBringToTop.value = currentScrollY > 20;
};

const getDocHeight = () => {
    return Math.max(
        document.body.scrollHeight, document.documentElement.scrollHeight,
        document.body.offsetHeight, document.documentElement.offsetHeight,
        document.body.clientHeight, document.documentElement.clientHeight
    );
};


const sidebarStyle = computed(() => {
	if (isMobileView.value) {
		return {
			right: sidebarVisible.value ? '0' : '-105%',
			width: '385px',
			height: '100vh',
			top: '0',
			transform: 'translateX(0)'
		};
	} else {
		return {
			transform: sidebarVisible.value ? 'translateX(0)' : 'translateX(105%)',
			width: `${sidebarWidth.value}px`,
			height: 'calc(100vh - 40px)',
			top: '20px',
			right: '20px',
		};
	}
});

const desktopSidebarToggleStyle = computed(() => {
	if (isMobileView.value) {
		return { display: 'none' };
	} else {
		return {
			top: '20px',
			zIndex: '999',
			transition: 'all 0.3s ease-in-out'
		};
	}
});

const mainContentStyle = computed(() => {
	const effectiveMarginRight = sidebarVisible.value && !isMobileView.value
		? `${sidebarWidth.value + 20}px`
		: '0px';

	return {
		marginRight: effectiveMarginRight, 
		paddingTop: mainContentPaddingTop.value 
	};
});


const searchBarDynamicStyle = computed(() => {
	let style = {};
	if (isMobileView.value) {
		style.left = '0px';
		style.width = '100%';
		style.right = 'auto';
	} else {
		if (sidebarVisible.value) {
			style.right = `${sidebarWidth.value + 60}px`;
			style.left = '20px';
		} else {
			style.left = '20px';
			style.right = '20px';
		}
		style.width = 'auto';
	}
	return style;
});

const updateChart = () => {
	const svg = d3.select("#yearsChart");
	svg.selectAll("*").remove();

	const data = filteredYearsInModal.value;

	const margin = { top: 20, right: 30, bottom: 40, left: 60 };
	const width = document.querySelector('.chart-container').clientWidth - margin.left - margin.right;
	const height = 300 - margin.top - margin.bottom;
	
	const x = d3.scaleBand()
		.domain(data.map(d => d[0]))
		.range([0, width])
		.padding(0.1);

	const y = d3.scaleLinear()
		.domain([0, d3.max(data, d => d[1])]).nice()
		.range([height, 0]);
	
	const g = svg.append("g")
		.attr("transform", `translate(${margin.left},${margin.top})`);
	
	const xAxis = g => g
		.attr("transform", `translate(0,${height})`)
		.call(d3.axisBottom(x).tickSizeOuter(0))
		.selectAll("text")
		.style("text-anchor", "end")
		.attr("dx", "-.8em")
		.attr("dy", "1.5em")
		.attr("transform", "rotate(-65)");

	const yAxis = g => g
		.attr("transform", `translate(0,0)`)
		.call(d3.axisLeft(y).tickFormat(d3.format("d")))
		.selectAll("text")
		.attr("dx", "-1em");

	const barsGroup = g.append("g").attr("class", "bars");
	const tooltip = d3.select("#tooltip");

	const zoom = d3.zoom()
		.scaleExtent([1, 8])
		.translateExtent([[0, 0], [width, height]])
		.extent([[0, 0], [width, height]])
		.on("zoom", zoomed);
	
	svg.call(zoom);

	function zoomed(event) {
		x.range([0, width].map(d => event.transform.applyX(d)));
		
		barsGroup.selectAll("rect")
			.attr("x", d => x(d[0]))
			.attr("width", x.bandwidth());
		
		g.selectAll(".x-axis").call(xAxis);
	}
	
	barsGroup.selectAll(".bar")
		.data(data)
		.enter().append("rect")
		.attr("class", "bar")
		.attr("x", d => x(d[0]))
		.attr("y", d => y(d[1]))
		.attr("width", x.bandwidth())
		.attr("height", d => height - y(d[1]))
		.on("mouseover", (event, d) => {
			tooltip.transition().duration(200).style("opacity", .9);
			const [xPos, yPos] = d3.pointer(event);
			tooltip.html(`سال: ${d[0]}<br/>پوستر: ${d[1].toLocaleString('fa')}`)
				   .style("left", (xPos + margin.left) + "px")
				   .style("top", (yPos + margin.top - 28) + "px");
		})
		.on("mouseout", () => {
			tooltip.transition().duration(500).style("opacity", 0);
		})
		.on("click", (event, d) => selectYearFromModal(d[0]));

	g.append("g").attr("class", "x-axis").call(xAxis);
	g.append("g").attr("class", "y-axis").call(yAxis);

	g.append("text")
		.attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
		.style("text-anchor", "middle")
		.text("سال");

	g.append("text")
		.attr("transform", "rotate(-90)")
		.attr("y", 0 - margin.left + 15)
		.attr("x", 0 - (height / 2 - 10))
		.attr("dy", "1em")
		.style("text-anchor", "middle")
		.text("تعداد پوستر");

};

{
	const script = document.createElement('script');
	script.src = './d3.v7.min.js';
	script.onload = () => isD3Loaded.value = true;
	document.body.appendChild(script);
}
watch([filteredYearsInModal, isD3Loaded], () => {
	isD3Loaded.value && nextTick(updateChart);
}, { immediate: true });


onMounted(() => {
	const checkMobile = () => {
		isMobileView.value = window.innerWidth <= 768;
		// Update placeholder immediately after checking mobile view
		if (isMobileView.value) {
			searchPlaceholder.value = 'جستجو';
		} else {
			searchPlaceholder.value = 'جستجو (برای پرش به کادر جستجو / را تایپ کنید)';
		}
	};

	window.addEventListener('resize', checkMobile);
	checkMobile();
	window.addEventListener('scroll', handleScroll);

	// با استفاده از ResizeObserver، ارتفاع نوار جستجو را به صورت پویا و قابل اطمینان دریافت می‌کنیم.
	if (searchBarRef.value) {
		const resizeObserver = new ResizeObserver(entries => {
			for (let entry of entries) {
				searchBarHeight.value = entry.contentRect.height;
			}
		});
		resizeObserver.observe(searchBarRef.value);
	}
});

onUnmounted(() => {
	window.removeEventListener('scroll', handleScroll);
	window.removeEventListener('resize', checkMobile);
});

// Watch for changes in cleanMode to reset background color
watch(cleanMode, (newValue) => {
	if (newValue) { // Minimal mode is ON
		backgroundColor.value = savedMinimalColor.value;
	} else { // Minimal mode is OFF
		savedMinimalColor.value = backgroundColor.value;
		backgroundColor.value = '#ffffff';
	}
});


window.addEventListener('keydown', () => {
	if (event.keyCode === 27) closeLightbox();
});

window.addEventListener('keydown', (event) => {
	if (event.key === '/' && !['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) {
		event.preventDefault();
		const searchInput = document.querySelector('input[type="text"][placeholder*="پرش"]');
		if (searchInput) {
			searchInput.focus();
		}
	}
});

return {
	showMore, isShowMore, searchTerm, combineSimilarChars, posterMode, filteredItems, items,
	getItemUrl, getCommonsUrl, getItemTitleWithYear, darkMode, toggleDarkMode, sortOrder, sortDirection, selectedYear,
	availableYears, availableDesigners, selectedDesigner, filteredYears, bringToTop, visibleBringToTop,
	filteredDesigners, designerQuery, selectDesigner, filteredDirectors, availableDirectors,
	selectedDirector, persianAlphabet, selectedLetter, letterCounts, resetFilters, togglePosterMode, toggleSortDirection,
	toggleOptions, isOptionsCollapsed, collapseIconClass, filteredDesignersInModal, designerSearchQuery,
	selectDesignerFromModal, filteredDirectorsInModal, selectDirectorFromModal, filteredYearsInModal,
	selectYearFromModal, filteredLettersInModal, selectLetterFromModal, isCollapsed, toggleCollapse,
	filteredYearLabel, filteredDesignerLabel, filteredDirectorLabel, filteredLetterLabel, getSectionClass,
	directorSearchQuery, sidebarWidth, minSidebarWidth, maxSidebarWidth, removeYearFilter,
	removeDesignerFilter, removeDirectorFilter, removeLetterFilter, hoveredItem, hideSidebar,
	sidebarVisible, uniqueFilmCount, toggleSidebar, pixelatedEffect, cleanMode, backgroundColor, clearSearchTerm, lightboxItem,
	lightboxImage, openLightbox, closeLightbox, downloadLink, handleImageClick,
	clearDesignerSearchQuery, clearDirectorSearchQuery, selectYearFromTitle, toPersianYear, isLoading,
	handlePopState, activeFilters, removeFilter, filteredItemsLength, itemsLength, prevImage, nextImage,
	searchPlaceholder, onSearchFocus, onSearchBlur, displayedItemsCount, showMore, uniqueResultsFilmCount,
	hasActiveFilters, exactWordMatch, isSearchBarVisible, searchBarRef, mainContentPaddingTop,
	searchBarDynamicStyle, sidebarStyle, desktopSidebarToggleStyle, toggleSidebarDesktop,
	handleDesktopSidebarHoverEnter, handleDesktopSidebarHoverLeave, mainContentStyle
};

} }).mount('#app');
</script>
</body>
</html>
